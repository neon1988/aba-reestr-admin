import{M as C,N as E,O as S,r as U,w as B,o as w,a8 as N,_ as D,Q as _,R as c,S as s,T as t,U as y,W as x,V as k}from"./index-B6qH9XSO.js";import{a as z,Q as A}from"./QToolbar-By_3Imut.js";import{Q as I}from"./use-transition-BofM6uWm.js";import{Q as l}from"./QInput-jbpBbB-l.js";import{Q as P}from"./QSelect-Ddmp4s-i.js";import{Q as T}from"./QForm-CRAoDmLE.js";import{Q as O,a as R}from"./QInnerLoading-BJccYjER.js";import{Q as j}from"./QPage-CKg0Pufy.js";import{a as q,S as L}from"./SubscriptionLevelEnums-BmRVvbPK.js";import{u as M,a as p,U as G,b as W}from"./UploadFileComponent-Bfw95-WG.js";import"./use-dark-BGndNJUA.js";import"./focus-manager-BJWzFvJg.js";import"./QChip-D8J7Tj8H.js";import"./QItem-CiC-A5wx.js";import"./selection-d4bZ9Uml.js";import"./QDialog-ItVBQ28c.js";import"./format-DyQxkAtJ.js";import"./client-CkZ3x0JN.js";import"./QBadge-CKCjPtL-.js";const H=C({__name:"EditPage",props:{id:{}},setup(v,{expose:o}){o();const m=E(),r=S(),n=v,i=M("patch",()=>`/users/${n.id}`,{photo:void 0,name:"",lastname:"",middlename:"",subscription_level:"",subscription_ends_at:""}),e=U(!0);function g(u){return new Date(u).toISOString().slice(0,16)}const d=async()=>{try{const{data:u}=await q(n.id);u.data.subscription_ends_at&&(u.data.subscription_ends_at=g(u.data.subscription_ends_at)),i.setData(u.data)}catch{p("Не удалось загрузить пользователя","negative"),m.push("/users")}finally{e.value=!1}},Q=()=>{i.submit().then(()=>{p("Пользователь успешно обновлён","success"),r.user&&n.id===r.user.id&&r.fetchUser()}).catch(u=>{const{response:a}=u;if(a.status===422){const{opts:f}=W(a.data);N.create(f.value)}else p(a.data.message,"negative")})};function b(u){return Object.keys(u).filter(a=>Number.isNaN(Number(a))).map(a=>{const f=u[a];return a==="Free"&&(a="Без подписки"),a==="ParentsAndRelated"&&(a="Родители и смежники"),a==="Specialists"&&(a="Специалисты"),a==="Centers"&&(a="Центры"),{label:`${a}`,value:f}})}const F=b(L);B(()=>n.id,()=>{d()}),w(()=>{d()});const V={router:m,authStore:r,props:n,form:i,loading:e,formatDateForInput:g,loadUserData:d,submit:Q,enumToOptions:b,options:F,UploadFileComponent:G};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}});function J(v,o,m,r,n,i){return _(),c(j,{padding:""},{default:s(()=>[t(A,null,{default:s(()=>[t(y,{flat:"",icon:"arrow_back",onClick:o[0]||(o[0]=e=>r.router.go(-1))}),t(z,null,{default:s(()=>o[13]||(o[13]=[x("Редактировать профиль")])),_:1})]),_:1}),t(T,{onSubmit:r.submit,valid:r.form.valid},{default:s(()=>[t(r.UploadFileComponent,{modelValue:r.form.photo,"onUpdate:modelValue":o[1]||(o[1]=e=>r.form.photo=e),label:"Выбрать фото",error:r.form.invalid("photo"),"error-message":r.form.errors.photo,onChange:o[2]||(o[2]=e=>r.form.validate("photo"))},null,8,["modelValue","error","error-message"]),r.form.photo?(_(),c(I,{key:0,src:r.form.photo.url,"spinner-color":"white",class:"q-mb-md",style:{height:"10rem","max-width":"10rem"}},null,8,["src"])):k("",!0),t(l,{modelValue:r.form.name,"onUpdate:modelValue":o[3]||(o[3]=e=>r.form.name=e),outlined:"","lazy-rules":"",label:"Имя",error:r.form.invalid("name"),"error-message":r.form.errors.name,onBlur:o[4]||(o[4]=e=>r.form.validate("name"))},null,8,["modelValue","error","error-message"]),t(l,{modelValue:r.form.lastname,"onUpdate:modelValue":o[5]||(o[5]=e=>r.form.lastname=e),outlined:"","lazy-rules":"",label:"Фамилия",error:r.form.invalid("lastname"),"error-message":r.form.errors.lastname,onBlur:o[6]||(o[6]=e=>r.form.validate("lastname"))},null,8,["modelValue","error","error-message"]),t(l,{modelValue:r.form.middlename,"onUpdate:modelValue":o[7]||(o[7]=e=>r.form.middlename=e),outlined:"","lazy-rules":"",label:"Отчество",error:r.form.invalid("middlename"),"error-message":r.form.errors.middlename,onBlur:o[8]||(o[8]=e=>r.form.validate("middlename"))},null,8,["modelValue","error","error-message"]),t(P,{modelValue:r.form.subscription_level,"onUpdate:modelValue":o[9]||(o[9]=e=>r.form.subscription_level=e),options:r.options,label:"Тип подписки","lazy-rules":"",error:r.form.invalid("subscription_level"),"error-message":r.form.errors.subscription_level,onBlur:o[10]||(o[10]=e=>r.form.validate("subscription_level")),"emit-value":"","map-options":""},null,8,["modelValue","options","error","error-message"]),t(l,{modelValue:r.form.subscription_ends_at,"onUpdate:modelValue":o[11]||(o[11]=e=>r.form.subscription_ends_at=e),label:"Дата окончания подписки",type:"datetime-local","lazy-rules":"",error:r.form.invalid("subscription_ends_at"),"error-message":r.form.errors.subscription_ends_at,onBlur:o[12]||(o[12]=e=>r.form.validate("subscription_ends_at"))},null,8,["modelValue","error","error-message"]),t(y,{type:"submit",label:"Сохранить изменения",color:"primary",class:"full-width q-mt-md"})]),_:1},8,["valid"]),t(R,{showing:r.loading},{default:s(()=>[t(O,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})}const pr=D(H,[["render",J],["__file","EditPage.vue"]]);export{pr as default};
