import{a as N,Q as P}from"./QToolbar-BVmsPAij.js";import{u as S,a as s,b as U,Q as b}from"./useValidationNotification-DJ3O0idh.js";import{Q as h}from"./use-transition-4mtm_1Sm.js";import{Q as p}from"./QInput-Cq_516xi.js";import{c as I,Q as T}from"./files-DDZKinJd.js";import{Q as _}from"./QCardSection-CkOy_myj.js";import{O as A,P as R,r as m,o as W,ag as z,_ as O,S as g,T as y,U as u,V as l,Y as j,X as C,W as B}from"./index-B5fKhRmK.js";import{Q as q}from"./QCardActions-c7eJt_Iw.js";import{Q as G}from"./QCard-DxAewxH7.js";import{Q as L}from"./QForm-CDspX6ko.js";import{Q as M,a as X}from"./QInnerLoading-DS7qhBsl.js";import{Q as Y}from"./QPage-6isNs5ct.js";import{c as H}from"./images-CvNZJFGB.js";import{a as J}from"./worksheets-Dfn_Hftz.js";import"./QChip-NOoku7Xo.js";import"./use-dark-CI_1RVc7.js";import"./format-DyQxkAtJ.js";import"./client-eJeKpGNL.js";import"./focus-manager-BJWzFvJg.js";const K=A({__name:"EditPage",props:{id:{}},setup(Q,{expose:r}){r();const n=R(),e=Q,t=S("patch",`/worksheets/${e.id}`,{cover:"",title:"",description:"",price:"",file:""}),i=m(!0),o=m(null),d=m(null),f=m(null),c=m(null),V=async()=>{try{const{data:a}=await J(e.id);a.data.cover&&(d.value=a.data.cover,a.data.cover=null),a.data.file&&(c.value=a.data.file,a.data.file=null),t.setData(a.data)}catch{s("Не удалось загрузить данные материала","negative"),n.push("/worksheets")}finally{i.value=!1}},F=async()=>{if(o.value){i.value=!0;try{const a=await H(o.value);d.value=a.data,t.cover=a.data.path,s("Обложка успешно загружена","success")}finally{i.value=!1}}},D=async()=>{if(f.value){i.value=!0;try{const a=await I(f.value);c.value=a.data,t.file=a.data.path,s("Файл записи успешно загружен","success")}finally{i.value=!1}}},k=()=>{t.submit().then(()=>{s("Материал успешно обновлён","success"),n.push("/worksheets")}).catch(a=>{const{response:v}=a;if(v.status===422){const{opts:E}=U(v.data);z.create(E.value)}else s(v.data.message,"negative")})},x=()=>{n.push("/worksheets")};W(()=>{V()});const w={router:n,props:e,form:t,loading:i,cover:o,previewCover:d,file:f,previewFile:c,loadWorksheetData:V,uploadFile:F,uploadRecordFile:D,submit:k,cancel:x};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}});function Z(Q,r,n,e,t,i){return g(),y(Y,{padding:""},{default:u(()=>[l(P,null,{default:u(()=>[l(N,null,{default:u(()=>r[10]||(r[10]=[j("Редактирование материала")])),_:1})]),_:1}),l(L,{onSubmit:e.submit,valid:e.form.valid},{default:u(()=>[l(G,null,{default:u(()=>[l(_,null,{default:u(()=>[l(b,{label:"Выберите файл обложки",modelValue:e.cover,"onUpdate:modelValue":[r[0]||(r[0]=o=>e.cover=o),e.uploadFile],filled:"",color:"primary",error:e.form.invalid("cover"),"error-message":e.form.errors.cover,onChange:r[1]||(r[1]=o=>e.form.validate("cover"))},null,8,["modelValue","error","error-message"]),e.previewCover?(g(),y(h,{key:0,src:e.previewCover.url,"spinner-color":"white",class:"q-mb-sm",style:{height:"10rem","max-width":"10rem"}},null,8,["src"])):C("",!0),l(p,{modelValue:e.form.title,"onUpdate:modelValue":r[2]||(r[2]=o=>e.form.title=o),label:"Название материала","lazy-rules":"",error:e.form.invalid("title"),"error-message":e.form.errors.title,onBlur:r[3]||(r[3]=o=>e.form.validate("title"))},null,8,["modelValue","error","error-message"]),l(p,{modelValue:e.form.description,"onUpdate:modelValue":r[4]||(r[4]=o=>e.form.description=o),label:"Описание материала",type:"textarea",autogrow:"",error:e.form.invalid("description"),"error-message":e.form.errors.description,onBlur:r[5]||(r[5]=o=>e.form.validate("description"))},null,8,["modelValue","error","error-message"]),l(p,{modelValue:e.form.price,"onUpdate:modelValue":r[6]||(r[6]=o=>e.form.price=o),label:"Цена",type:"number",prefix:"₽",error:e.form.invalid("price"),"error-message":e.form.errors.price,onBlur:r[7]||(r[7]=o=>e.form.validate("price"))},null,8,["modelValue","error","error-message"]),l(b,{label:"Выберите файл",modelValue:e.file,"onUpdate:modelValue":[r[8]||(r[8]=o=>e.file=o),e.uploadRecordFile],filled:"",color:"primary",error:e.form.invalid("file"),"error-message":e.form.errors.file,onChange:r[9]||(r[9]=o=>e.form.validate("file"))},null,8,["modelValue","error","error-message"]),e.previewFile?(g(),y(T,{key:1,"spinner-color":"white",src:e.previewFile.url},null,8,["src"])):C("",!0)]),_:1}),l(q,{align:"right"},{default:u(()=>[l(B,{label:"Сохранить изменения",type:"submit",color:"primary",loading:e.form.processing,icon:"save"},null,8,["loading"]),l(B,{label:"Отмена",color:"grey-6",flat:"",onClick:e.cancel,icon:"close"})]),_:1})]),_:1})]),_:1},8,["valid"]),l(X,{showing:e.loading},{default:u(()=>[l(M,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})}const Qe=O(K,[["render",Z],["__file","EditPage.vue"]]);export{Qe as default};
