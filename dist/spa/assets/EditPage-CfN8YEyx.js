import{M as U,N as B,O as S,r as c,w as y,o as w,a8 as D,_ as N,Q as _,R as E,S as n,T as t,U as Q,W as A,V as x}from"./index-Cv4oVPAd.js";import{a as T,Q as k}from"./QToolbar-Dgs45zlN.js";import{Q as z}from"./use-transition-BK_bggcp.js";import{Q as l}from"./QInput-CuBXEqnW.js";import{Q as P}from"./QSelect-DaGnDfM2.js";import{Q as I}from"./QForm-wqqTSnz_.js";import{Q as O,a as M}from"./QInnerLoading-ppFWeswD.js";import{Q as Y}from"./QPage-j7VYUl3K.js";import{a as R,S as j}from"./SubscriptionLevelEnums-BSAa9pOz.js";import{d as q}from"./date-jwst40y2.js";import{u as H,a as p,U as L,b as G}from"./UploadFileComponent-DnxAZsjn.js";import"./use-dark-BXHPfObA.js";import"./focus-manager-BJWzFvJg.js";import"./QChip-JDXiz75R.js";import"./QItem-znc3dPhO.js";import"./selection-B2BDvGQk.js";import"./QDialog-a0Au42Fz.js";import"./format-DyQxkAtJ.js";import"./client-C6VKEaho.js";import"./QBadge-C-erP5HS.js";const W=U({__name:"EditPage",props:{id:{}},setup(v,{expose:o}){o();const m=B(),r=S(),i=c(null),s=v,e=H("patch",()=>`/users/${s.id}`,{photo:void 0,name:"",lastname:"",middlename:"",subscription_level:"",subscription_ends_at:""}),b=c(!0),d=async()=>{try{const{data:u}=await R(s.id);u.data.subscription_ends_at&&(i.value=q.formatDate(u.data.subscription_ends_at,"YYYY-MM-DDTHH:mm")),e.setData(u.data)}catch{p("Не удалось загрузить пользователя","negative"),m.push("/users")}finally{b.value=!1}},C=()=>{e.submit().then(()=>{p("Пользователь успешно обновлён","success"),r.user&&s.id===r.user.id&&r.fetchUser()}).catch(u=>{const{response:a}=u;if(a.status===422){const{opts:f}=G(a.data);D.create(f.value)}else p(a.data.message,"negative")})};function g(u){return Object.keys(u).filter(a=>Number.isNaN(Number(a))).map(a=>{const f=u[a];return a==="Free"&&(a="Без подписки"),a==="ParentsAndRelated"&&(a="Подписка A"),a==="Specialists"&&(a="Подписка B"),a==="Centers"&&(a="Подписка C"),{label:`${a}`,value:f}})}const F=g(j);y(()=>s.id,()=>{d()}),y(i,u=>{u?e.subscription_ends_at=new Date(u).toISOString():e.subscription_ends_at=""}),w(()=>{d()});const V={router:m,authStore:r,subscriptionEndsAt:i,props:s,form:e,loading:b,loadUserData:d,submit:C,enumToOptions:g,options:F,UploadFileComponent:L};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}});function J(v,o,m,r,i,s){return _(),E(Y,{padding:""},{default:n(()=>[t(k,null,{default:n(()=>[t(Q,{flat:"",icon:"arrow_back",onClick:o[0]||(o[0]=e=>r.router.go(-1))}),t(T,null,{default:n(()=>o[13]||(o[13]=[A("Редактировать профиль")])),_:1})]),_:1}),t(I,{onSubmit:r.submit,valid:r.form.valid},{default:n(()=>[t(r.UploadFileComponent,{modelValue:r.form.photo,"onUpdate:modelValue":o[1]||(o[1]=e=>r.form.photo=e),label:"Выбрать фото",error:r.form.invalid("photo"),"error-message":r.form.errors.photo,onChange:o[2]||(o[2]=e=>r.form.validate("photo"))},null,8,["modelValue","error","error-message"]),r.form.photo?(_(),E(z,{key:0,src:r.form.photo.url,"spinner-color":"white",class:"q-mb-md",style:{height:"10rem","max-width":"10rem"}},null,8,["src"])):x("",!0),t(l,{modelValue:r.form.name,"onUpdate:modelValue":o[3]||(o[3]=e=>r.form.name=e),outlined:"","lazy-rules":"",label:"Имя",error:r.form.invalid("name"),"error-message":r.form.errors.name,onBlur:o[4]||(o[4]=e=>r.form.validate("name"))},null,8,["modelValue","error","error-message"]),t(l,{modelValue:r.form.lastname,"onUpdate:modelValue":o[5]||(o[5]=e=>r.form.lastname=e),outlined:"","lazy-rules":"",label:"Фамилия",error:r.form.invalid("lastname"),"error-message":r.form.errors.lastname,onBlur:o[6]||(o[6]=e=>r.form.validate("lastname"))},null,8,["modelValue","error","error-message"]),t(l,{modelValue:r.form.middlename,"onUpdate:modelValue":o[7]||(o[7]=e=>r.form.middlename=e),outlined:"","lazy-rules":"",label:"Отчество",error:r.form.invalid("middlename"),"error-message":r.form.errors.middlename,onBlur:o[8]||(o[8]=e=>r.form.validate("middlename"))},null,8,["modelValue","error","error-message"]),t(P,{modelValue:r.form.subscription_level,"onUpdate:modelValue":o[9]||(o[9]=e=>r.form.subscription_level=e),options:r.options,label:"Тип подписки","lazy-rules":"",error:r.form.invalid("subscription_level"),"error-message":r.form.errors.subscription_level,onBlur:o[10]||(o[10]=e=>r.form.validate("subscription_level")),"emit-value":"","map-options":""},null,8,["modelValue","options","error","error-message"]),t(l,{modelValue:r.subscriptionEndsAt,"onUpdate:modelValue":o[11]||(o[11]=e=>r.subscriptionEndsAt=e),label:"Дата окончания подписки",type:"datetime-local","lazy-rules":"",error:r.form.invalid("subscription_ends_at"),"error-message":r.form.errors.subscription_ends_at,onBlur:o[12]||(o[12]=e=>r.form.validate("subscription_ends_at"))},null,8,["modelValue","error","error-message"]),t(Q,{type:"submit",label:"Сохранить изменения",color:"primary",class:"full-width q-mt-md"})]),_:1},8,["valid"]),t(M,{showing:r.loading},{default:n(()=>[t(O,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})}const br=N(W,[["render",J],["__file","EditPage.vue"]]);export{br as default};
