import{a as _,Q as T,b as y}from"./QItem-BymqpaLI.js";import{Q as x}from"./QSelect-CX0YbX3P.js";import{m as w,af as I,ab as N,L as Q,_ as A,r as u,w as g,Q as m,R as f,S as r,T as c,W as v,Z as S,V as C,A as L,ag as q,ah as D}from"./index-BRIAkyOr.js";import{k as E,l as K}from"./QDialog-DPbThiRL.js";function b(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const t=parseInt(e,10);return isNaN(t)?0:t}const B=w({name:"close-popup",beforeMount(e,{value:t}){const s={depth:b(t),handler(a){s.depth!==0&&setTimeout(()=>{const l=E(e);l!==void 0&&K(l,a,s.depth)})},handlerKey(a){I(a,13)===!0&&s.handler(a)}};e.__qclosepopup=s,e.addEventListener("click",s.handler),e.addEventListener("keyup",s.handlerKey)},updated(e,{value:t,oldValue:s}){t!==s&&(e.__qclosepopup.depth=b(t))},beforeUnmount(e){const t=e.__qclosepopup;e.removeEventListener("click",t.handler),e.removeEventListener("keyup",t.handlerKey),delete e.__qclosepopup}}),R=(e="",t=1)=>N.get("/tags",{params:{search:e,page:t}}),V=Q("tags",{state:()=>({loading:!1,tags:[],meta:{},currentPage:1,search:""}),actions:{async fetchTags(){this.loading=!0;try{const e=await R(this.search,this.currentPage);this.tags=e.data.data,this.meta=e.data.meta,this.currentPage=this.meta.current_page}catch{}finally{this.loading=!1}}}}),U={__name:"TagInput",props:{modelValue:{type:Array,default:()=>[]},label:{type:String,default:"Теги"}},emits:["update:modelValue"],setup(e,{expose:t,emit:s}){t();const a=e,l=s,i=V(),o=u([]),p=u([]),d=u(null);g(()=>a.modelValue,n=>{n?o.value=n:o.value=[]},{immediate:!0}),g(()=>o.value,n=>{l("update:modelValue",n)});const h={props:a,emit:l,tagStore:i,selectedTags:o,filteredTags:p,tagSelect:d,filterTags:(n,P)=>{P(async()=>{i.search=n,await i.fetchTags(),p.value=i.tags.map(k=>k.name)})},onAddTag:()=>{d.value.updateInputValue("")},addNewTag:n=>{o.value.push(n),d.value.hidePopup(),d.value.updateInputValue("")},ref:u,watch:g,get useTagStore(){return V}};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}};function j(e,t,s,a,l,i){return m(),f(x,{modelValue:a.selectedTags,"onUpdate:modelValue":t[0]||(t[0]=o=>a.selectedTags=o),ref:"tagSelect","use-input":"","use-chips":"",multiple:"","input-debounce":"300",options:a.filteredTags,loading:a.tagStore.loading,label:s.label,onFilter:a.filterTags,onAdd:a.onAddTag,clearable:"","new-value-mode":"add-unique"},{"no-option":r(o=>[a.tagSelect.loading?C("",!0):(m(),f(_,{key:0,clickable:"",onClick:p=>a.addNewTag(o.inputValue)},{default:r(()=>[c(y,null,{default:r(()=>[c(T,{class:"text-primary"},{default:r(()=>[v(' Добавить новый тег "'+S(o.inputValue)+'"? ',1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))]),option:r(o=>[L((m(),f(_,q(D(o.itemProps)),{default:r(()=>[c(y,null,{default:r(()=>[c(T,null,{default:r(()=>[v(S(o.opt),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)),[[B]])]),_:1},8,["modelValue","options","loading","label"])}const H=A(U,[["render",j],["__file","TagInput.vue"]]);export{H as T};
