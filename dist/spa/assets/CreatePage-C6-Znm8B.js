import{a as B,Q as F}from"./QToolbar-BVmsPAij.js";import{u as E,a as m,b as k,Q}from"./useValidationNotification-DJ3O0idh.js";import{Q as x}from"./use-transition-4mtm_1Sm.js";import{Q as f}from"./QInput-Cq_516xi.js";import{c as D,Q as _}from"./files-DDZKinJd.js";import{Q as N}from"./QCardSection-CkOy_myj.js";import{O as P,P as S,r as t,ag as U,_ as T,S as v,T as c,U as l,V as u,Y as I,X as b,W as V}from"./index-B5fKhRmK.js";import{Q as A}from"./QCardActions-c7eJt_Iw.js";import{Q as O}from"./QCard-DxAewxH7.js";import{Q as h}from"./QForm-CDspX6ko.js";import{Q as j,a as q}from"./QInnerLoading-DS7qhBsl.js";import{Q as z}from"./QPage-6isNs5ct.js";import{c as G}from"./images-CvNZJFGB.js";import"./QChip-NOoku7Xo.js";import"./use-dark-CI_1RVc7.js";import"./format-DyQxkAtJ.js";import"./client-eJeKpGNL.js";import"./focus-manager-BJWzFvJg.js";const L=P({__name:"CreatePage",setup(y,{expose:r}){r();const n=S(),e=E("post","/worksheets",{title:"",description:"",cover:"",price:"",file:""}),i=t(!1),s=t(null),o=t(null),p=t(null),g=t(null),C={router:n,form:e,loading:i,cover:s,file:o,previewCover:p,previewFile:g,uploadCover:async()=>{if(s.value){i.value=!0;try{const a=await G(s.value);p.value=a.data,e.cover=a.data.path,m("Обложка успешно загружена","success")}finally{i.value=!1}}},uploadFile:async()=>{if(o.value){i.value=!0;try{const a=await D(o.value);g.value=a.data,e.file=a.data.path,m("Файл успешно загружен","success")}finally{i.value=!1}}},submit:()=>{e.submit().then(()=>{m("Материал успешно создан","success"),n.push("/worksheets")}).catch(a=>{const{response:d}=a;if(d.status===422){const{opts:w}=k(d.data);U.create(w.value)}else m(d.data.message,"negative")})},cancel:()=>{n.push("/worksheets")}};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}});function R(y,r,n,e,i,s){return v(),c(z,{padding:""},{default:l(()=>[u(F,null,{default:l(()=>[u(B,null,{default:l(()=>r[10]||(r[10]=[I("Создание нового материала")])),_:1})]),_:1}),u(h,{onSubmit:e.submit,valid:e.form.valid},{default:l(()=>[u(O,null,{default:l(()=>[u(N,null,{default:l(()=>[u(Q,{label:"Выберите файл обложки",modelValue:e.cover,"onUpdate:modelValue":[r[0]||(r[0]=o=>e.cover=o),e.uploadCover],filled:"",color:"primary",error:e.form.invalid("cover"),"error-message":e.form.errors.cover,onChange:r[1]||(r[1]=o=>e.form.validate("cover"))},null,8,["modelValue","error","error-message"]),e.previewCover?(v(),c(x,{key:0,src:e.previewCover.url,"spinner-color":"white",class:"q-mb-sm",style:{height:"10rem","max-width":"10rem"}},null,8,["src"])):b("",!0),u(f,{modelValue:e.form.title,"onUpdate:modelValue":r[2]||(r[2]=o=>e.form.title=o),label:"Название материала",error:e.form.invalid("title"),"error-message":e.form.errors.title,onChange:r[3]||(r[3]=o=>e.form.validate("title"))},null,8,["modelValue","error","error-message"]),u(f,{modelValue:e.form.description,"onUpdate:modelValue":r[4]||(r[4]=o=>e.form.description=o),label:"Описание материала",type:"textarea",error:e.form.invalid("description"),"error-message":e.form.errors.description,onChange:r[5]||(r[5]=o=>e.form.validate("description"))},null,8,["modelValue","error","error-message"]),u(f,{modelValue:e.form.price,"onUpdate:modelValue":r[6]||(r[6]=o=>e.form.price=o),label:"Цена",error:e.form.invalid("price"),"error-message":e.form.errors.price,onChange:r[7]||(r[7]=o=>e.form.validate("price"))},null,8,["modelValue","error","error-message"]),u(Q,{label:"Выберите файл записи",modelValue:e.file,"onUpdate:modelValue":[r[8]||(r[8]=o=>e.file=o),e.uploadFile],filled:"",color:"primary",error:e.form.invalid("file"),"error-message":e.form.errors.file,onChange:r[9]||(r[9]=o=>e.form.validate("file"))},null,8,["modelValue","error","error-message"]),e.previewFile?(v(),c(_,{key:1,"spinner-color":"white",src:e.previewFile.url},null,8,["src"])):b("",!0)]),_:1}),u(A,null,{default:l(()=>[u(V,{label:"Создать материал",type:"submit",color:"primary",disabled:e.form.processing},null,8,["disabled"]),u(V,{label:"Отмена",color:"secondary",onClick:e.cancel})]),_:1})]),_:1})]),_:1},8,["valid"]),u(q,{showing:e.form.processing},{default:l(()=>[u(j,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})}const ve=T(L,[["render",R],["__file","CreatePage.vue"]]);export{ve as default};
