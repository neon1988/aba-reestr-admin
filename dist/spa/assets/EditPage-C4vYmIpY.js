import{a as U,Q as S}from"./QToolbar-CqsNtWoR.js";import{M as F,N as x,r as y,w as k,o as N,a8 as I,_ as A,Q as s,R as f,S as l,T as a,W as Q,U as v,V as P,Y as p}from"./index-Uar3rvXj.js";import{Q as T}from"./QBanner-KqTNsfqC.js";import{Q as W}from"./use-transition-C4qDLXDO.js";import{Q as n}from"./QInput-BpJn7DHK.js";import{Q as H}from"./QCardSection-BAxKoMXM.js";import{Q as q}from"./QCardActions-DW59NOAV.js";import{Q as z}from"./QCard--x601cN9.js";import{Q as M}from"./QForm-DUp0-K5h.js";import{Q as O,a as R}from"./QInnerLoading-BJlBIsYX.js";import{Q as j}from"./QPage-SnA9jhU2.js";import{u as G,a as g,U as L,b as Y}from"./UploadFileComponent-DDs7MltY.js";import{b as J,d as K}from"./webinars-BfFl9cSP.js";import{u as X}from"./stat-store-BfqwQI1J.js";import"./use-dark-BJRxIyn1.js";import"./focus-manager-BJWzFvJg.js";import"./client-DTfBgloa.js";import"./QBadge-D6SAPWM9.js";import"./QChip-CLISOAhs.js";import"./format-DyQxkAtJ.js";const Z=F({__name:"EditPage",props:{id:{}},setup(V,{expose:e}){e();const c=X(),r=x(),m=V,t=y(null),o=G("patch",()=>`/webinars/${m.id}`,{title:"",description:"",start_at:"",end_at:"",cover:void 0,stream_url:"",price:"",record_file:void 0}),i=y(!0);function b(u){return new Date(u).toISOString().slice(0,16)}const _=async()=>{i.value=!0;try{const{data:u}=await J(m.id);u.data.start_at&&(u.data.start_at=b(u.data.start_at)),u.data.end_at&&(u.data.end_at=b(u.data.end_at)),t.value=u.data}catch{g("Не удалось загрузить данные вебинара","negative"),r.push("/webinars")}finally{i.value=!1}},w=()=>{i.value=!0,o.submit().then(()=>{g("Вебинар успешно обновлён","success"),r.push("/webinars")}).catch(u=>{const{response:d}=u;if(d.status===422){const{opts:E}=Y(d.data);I.create(E.value)}else g(d.data.message,"negative")}).finally(()=>{i.value=!1})},B=async()=>{i.value=!0;try{const{data:u}=await K(m.id);t.value=u.data,await c.fetchStats()}catch{g("Не удалось удалить вебинар","negative")}finally{i.value=!1}},C=()=>{r.push("/webinars")};k(t,()=>{t.value&&o.setData(t.value)}),N(()=>{_()});const D={statStore:c,router:r,props:m,webinar:t,form:o,loading:i,formatDateForInput:b,loadWebinarData:_,submit:w,deleteHandler:B,cancel:C,UploadFileComponent:L};return Object.defineProperty(D,"__isScriptSetup",{enumerable:!1,value:!0}),D}}),h={class:"row q-col-gutter-sm"},$={class:"col-6"},rr={class:"col-6"};function er(V,e,c,r,m,t){return s(),f(j,{padding:""},{default:l(()=>[a(S,null,{default:l(()=>[a(U,null,{default:l(()=>e[16]||(e[16]=[Q("Редактирование вебинара")])),_:1})]),_:1}),r.webinar&&r.webinar.deleted_at?(s(),f(T,{key:0,"inline-actions":"",rounded:"",class:"bg-primary text-white"},{action:l(()=>[a(v,{flat:"",color:"white",label:"Восстановить",onClick:r.deleteHandler})]),default:l(()=>[e[17]||(e[17]=Q(" Вебинар успешно удален "))]),_:1})):(s(),f(M,{key:1,onSubmit:r.submit,valid:r.form.valid},{default:l(()=>[a(z,null,{default:l(()=>[a(H,null,{default:l(()=>[a(r.UploadFileComponent,{modelValue:r.form.cover,"onUpdate:modelValue":e[0]||(e[0]=o=>r.form.cover=o),label:"Выбрать обложку",error:r.form.invalid("cover"),"error-message":r.form.errors.cover,onChange:e[1]||(e[1]=o=>r.form.validate("cover"))},null,8,["modelValue","error","error-message"]),r.form.cover?(s(),f(W,{key:0,src:r.form.cover.url,"spinner-color":"white",class:"q-mb-sm",style:{height:"10rem","max-width":"10rem"}},null,8,["src"])):P("",!0),a(n,{modelValue:r.form.title,"onUpdate:modelValue":e[2]||(e[2]=o=>r.form.title=o),label:"Название вебинара","lazy-rules":"",error:r.form.invalid("title"),"error-message":r.form.errors.title,onBlur:e[3]||(e[3]=o=>r.form.validate("title"))},null,8,["modelValue","error","error-message"]),a(n,{modelValue:r.form.description,"onUpdate:modelValue":e[4]||(e[4]=o=>r.form.description=o),label:"Описание вебинара",type:"textarea",autogrow:"",error:r.form.invalid("description"),"error-message":r.form.errors.description,onBlur:e[5]||(e[5]=o=>r.form.validate("description"))},null,8,["modelValue","error","error-message"]),a(n,{modelValue:r.form.stream_url,"onUpdate:modelValue":e[6]||(e[6]=o=>r.form.stream_url=o),label:"Ссылка на трансляцию",error:r.form.invalid("stream_url"),"error-message":r.form.errors.stream_url,onBlur:e[7]||(e[7]=o=>r.form.validate("stream_url"))},null,8,["modelValue","error","error-message"]),a(n,{modelValue:r.form.price,"onUpdate:modelValue":e[8]||(e[8]=o=>r.form.price=o),label:"Цена",type:"number",prefix:"₽",error:r.form.invalid("price"),"error-message":r.form.errors.price,onBlur:e[9]||(e[9]=o=>r.form.validate("price"))},null,8,["modelValue","error","error-message"]),p("div",h,[p("div",$,[a(n,{modelValue:r.form.start_at,"onUpdate:modelValue":e[10]||(e[10]=o=>r.form.start_at=o),label:"Дата начала",type:"datetime-local",error:r.form.invalid("start_at"),"error-message":r.form.errors.start_at,onBlur:e[11]||(e[11]=o=>r.form.validate("start_at"))},null,8,["modelValue","error","error-message"])]),p("div",rr,[a(n,{modelValue:r.form.end_at,"onUpdate:modelValue":e[12]||(e[12]=o=>r.form.end_at=o),label:"Дата окончания",type:"datetime-local",error:r.form.invalid("end_at"),"error-message":r.form.errors.end_at,onBlur:e[13]||(e[13]=o=>r.form.validate("end_at"))},null,8,["modelValue","error","error-message"])])]),a(r.UploadFileComponent,{modelValue:r.form.record_file,"onUpdate:modelValue":e[14]||(e[14]=o=>r.form.record_file=o),label:"Выбрать файл",error:r.form.invalid("record_file"),"error-message":r.form.errors.record_file,onChange:e[15]||(e[15]=o=>r.form.validate("record_file"))},null,8,["modelValue","error","error-message"])]),_:1}),a(q,{align:"right"},{default:l(()=>[a(v,{label:"Сохранить изменения",type:"submit",color:"primary",loading:r.form.processing,icon:"save"},null,8,["loading"]),a(v,{label:"Отмена",color:"grey-6",flat:"",onClick:r.cancel,icon:"close"}),a(v,{flat:"",dense:"",icon:"delete",color:"red",onClick:r.deleteHandler})]),_:1})]),_:1})]),_:1},8,["valid"])),a(R,{showing:r.loading},{default:l(()=>[a(O,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})}const Qr=A(Z,[["render",er],["__file","EditPage.vue"]]);export{Qr as default};
