import{M as U,N as B,O as S,r as c,w as _,o as w,a8 as D,_ as N,Q as y,R as C,S as l,T as t,U as E,W as A,V as x}from"./index-Bc0R355J.js";import{a as I,Q as T}from"./QToolbar-fsbRQWuM.js";import{Q as i}from"./QInput-KLQz9GaB.js";import{Q as k}from"./QSelect-9FLbZ_gn.js";import{Q as z}from"./QForm-CO8bnY9c.js";import{Q as P,a as O}from"./QInnerLoading-BHVqACUk.js";import{Q as M}from"./QPage-SQbvXMJf.js";import{a as Y,S as q}from"./SubscriptionLevelEnums-CX-tGJvd.js";import{d as R}from"./date-BaulYPxB.js";import{u as j,a as p,U as H,b as L}from"./UploadFileComponent-C-GoAgnv.js";import{I as G}from"./ImageComponent-m-e6C0wA.js";import"./use-dark-B6AwncSa.js";import"./focus-manager-zjdVGI5d.js";import"./QChip-BcyO6mis.js";import"./QItem-BlZjPOp4.js";import"./selection-hq7Irpgn.js";import"./ImageFullscreen-BMuWzocu.js";import"./format-DyQxkAtJ.js";import"./client-5NLhBQvt.js";import"./QBadge-Ba0Rv4Xu.js";const W=U({__name:"EditPage",props:{id:{}},setup(v,{expose:r}){r();const m=B(),o=S(),s=c(null),n=v,e=j("patch",()=>`/users/${n.id}`,{photo:void 0,name:"",lastname:"",middlename:"",subscription_level:"",subscription_ends_at:""}),b=c(!0),d=async()=>{try{const{data:u}=await Y(n.id);u.data.subscription_ends_at&&(s.value=R.formatDate(u.data.subscription_ends_at,"YYYY-MM-DDTHH:mm")),e.setData(u.data)}catch{p("Не удалось загрузить пользователя","negative"),m.push("/users")}finally{b.value=!1}},Q=()=>{e.submit().then(()=>{p("Пользователь успешно обновлён","success"),o.user&&n.id===o.user.id&&o.fetchUser()}).catch(u=>{const{response:a}=u;if(a.status===422){const{opts:f}=L(a.data);D.create(f.value)}else p(a.data.message,"negative")})};function g(u){return Object.keys(u).filter(a=>Number.isNaN(Number(a))).map(a=>{const f=u[a];return a==="Free"&&(a="Без подписки"),a==="ParentsAndRelated"&&(a="Подписка A"),a==="Specialists"&&(a="Подписка B"),a==="Centers"&&(a="Подписка C"),{label:`${a}`,value:f}})}const F=g(q);_(()=>n.id,()=>{d()}),_(s,u=>{u?e.subscription_ends_at=new Date(u).toISOString():e.subscription_ends_at=""}),w(()=>{d()});const V={router:m,authStore:o,subscriptionEndsAt:s,props:n,form:e,loading:b,loadUserData:d,submit:Q,enumToOptions:g,options:F,UploadFileComponent:H,ImageComponent:G};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}});function J(v,r,m,o,s,n){return y(),C(M,{padding:""},{default:l(()=>[t(T,null,{default:l(()=>[t(E,{flat:"",icon:"arrow_back",onClick:r[0]||(r[0]=e=>o.router.go(-1))}),t(I,null,{default:l(()=>r[13]||(r[13]=[A("Редактировать профиль")])),_:1})]),_:1}),t(z,{onSubmit:o.submit,valid:o.form.valid},{default:l(()=>[t(o.UploadFileComponent,{modelValue:o.form.photo,"onUpdate:modelValue":r[1]||(r[1]=e=>o.form.photo=e),label:"Выбрать фото",error:o.form.invalid("photo"),"error-message":o.form.errors.photo,onChange:r[2]||(r[2]=e=>o.form.validate("photo"))},null,8,["modelValue","error","error-message"]),o.form.photo?(y(),C(o.ImageComponent,{key:0,class:"q-mb-md",url:o.form.photo.url,"max-width":200,"max-height":200,fit:"scale-down","allow-fullscreen":"","quasar-component":""},null,8,["url"])):x("",!0),t(i,{modelValue:o.form.name,"onUpdate:modelValue":r[3]||(r[3]=e=>o.form.name=e),outlined:"","lazy-rules":"",label:"Имя",error:o.form.invalid("name"),"error-message":o.form.errors.name,onBlur:r[4]||(r[4]=e=>o.form.validate("name"))},null,8,["modelValue","error","error-message"]),t(i,{modelValue:o.form.lastname,"onUpdate:modelValue":r[5]||(r[5]=e=>o.form.lastname=e),outlined:"","lazy-rules":"",label:"Фамилия",error:o.form.invalid("lastname"),"error-message":o.form.errors.lastname,onBlur:r[6]||(r[6]=e=>o.form.validate("lastname"))},null,8,["modelValue","error","error-message"]),t(i,{modelValue:o.form.middlename,"onUpdate:modelValue":r[7]||(r[7]=e=>o.form.middlename=e),outlined:"","lazy-rules":"",label:"Отчество",error:o.form.invalid("middlename"),"error-message":o.form.errors.middlename,onBlur:r[8]||(r[8]=e=>o.form.validate("middlename"))},null,8,["modelValue","error","error-message"]),t(k,{modelValue:o.form.subscription_level,"onUpdate:modelValue":r[9]||(r[9]=e=>o.form.subscription_level=e),options:o.options,label:"Тип подписки","lazy-rules":"",error:o.form.invalid("subscription_level"),"error-message":o.form.errors.subscription_level,onBlur:r[10]||(r[10]=e=>o.form.validate("subscription_level")),"emit-value":"","map-options":""},null,8,["modelValue","options","error","error-message"]),t(i,{modelValue:o.subscriptionEndsAt,"onUpdate:modelValue":r[11]||(r[11]=e=>o.subscriptionEndsAt=e),label:"Дата окончания подписки",type:"datetime-local","lazy-rules":"",error:o.form.invalid("subscription_ends_at"),"error-message":o.form.errors.subscription_ends_at,onBlur:r[12]||(r[12]=e=>o.form.validate("subscription_ends_at"))},null,8,["modelValue","error","error-message"]),t(E,{type:"submit",label:"Сохранить изменения",color:"primary",class:"full-width q-mt-md"})]),_:1},8,["valid"]),t(O,{showing:o.loading},{default:l(()=>[t(P,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})}const go=N(W,[["render",J],["__file","EditPage.vue"]]);export{go as default};
