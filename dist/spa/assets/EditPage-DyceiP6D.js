import{a as b,Q as y}from"./QToolbar-By_3Imut.js";import{Q as B}from"./use-transition-BofM6uWm.js";import{Q as s}from"./QInput-jbpBbB-l.js";import{Q as D}from"./QCardSection-Gp9p4F5O.js";import{M as w,N as k,r as U,o as x,a8 as E,_ as F,Q as g,R as v,S as u,T as a,W as N,V as S,U as c}from"./index-B6qH9XSO.js";import{Q as P}from"./QCardActions-DacgwXvn.js";import{Q as T}from"./QCard-CrCXEKdn.js";import{Q as _}from"./QForm-CRAoDmLE.js";import{Q as I,a as A}from"./QInnerLoading-BJccYjER.js";import{Q as W}from"./QPage-CKg0Pufy.js";import{u as h,a as d,U as z,b as M}from"./UploadFileComponent-Bfw95-WG.js";import{a as R}from"./worksheets-CPVAHWAH.js";import"./use-dark-BGndNJUA.js";import"./focus-manager-BJWzFvJg.js";import"./client-CkZ3x0JN.js";import"./QBadge-CKCjPtL-.js";import"./QChip-D8J7Tj8H.js";import"./format-DyQxkAtJ.js";const j=w({__name:"EditPage",props:{id:{}},setup(f,{expose:o}){o();const l=k(),r=f,i=h("patch",()=>`/worksheets/${r.id}`,{cover:void 0,title:"",description:"",price:"",file:void 0}),m=U(!0),e=async()=>{try{const{data:t}=await R(r.id);i.setData(t.data)}catch{d("Не удалось загрузить данные материала","negative"),l.push("/worksheets")}finally{m.value=!1}},Q=()=>{i.submit().then(()=>{d("Материал успешно обновлён","success"),l.push("/worksheets")}).catch(t=>{const{response:n}=t;if(n.status===422){const{opts:V}=M(n.data);E.create(V.value)}else d(n.data.message,"negative")})},C=()=>{l.push("/worksheets")};x(()=>{e()});const p={router:l,props:r,form:i,loading:m,loadWorksheetData:e,submit:Q,cancel:C,UploadFileComponent:z};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}});function q(f,o,l,r,i,m){return g(),v(W,{padding:""},{default:u(()=>[a(y,null,{default:u(()=>[a(b,null,{default:u(()=>o[10]||(o[10]=[N("Редактирование материала")])),_:1})]),_:1}),a(_,{onSubmit:r.submit,valid:r.form.valid},{default:u(()=>[a(T,null,{default:u(()=>[a(D,null,{default:u(()=>[a(r.UploadFileComponent,{modelValue:r.form.cover,"onUpdate:modelValue":o[0]||(o[0]=e=>r.form.cover=e),label:"Выбрать обложку",error:r.form.invalid("cover"),"error-message":r.form.errors.cover,onChange:o[1]||(o[1]=e=>r.form.validate("cover"))},null,8,["modelValue","error","error-message"]),r.form.cover?(g(),v(B,{key:0,src:r.form.cover.url,"spinner-color":"white",class:"q-mb-sm",style:{height:"10rem","max-width":"10rem"}},null,8,["src"])):S("",!0),a(s,{modelValue:r.form.title,"onUpdate:modelValue":o[2]||(o[2]=e=>r.form.title=e),label:"Название материала","lazy-rules":"",error:r.form.invalid("title"),"error-message":r.form.errors.title,onBlur:o[3]||(o[3]=e=>r.form.validate("title"))},null,8,["modelValue","error","error-message"]),a(s,{modelValue:r.form.description,"onUpdate:modelValue":o[4]||(o[4]=e=>r.form.description=e),label:"Описание материала",type:"textarea",autogrow:"",error:r.form.invalid("description"),"error-message":r.form.errors.description,onBlur:o[5]||(o[5]=e=>r.form.validate("description"))},null,8,["modelValue","error","error-message"]),a(s,{modelValue:r.form.price,"onUpdate:modelValue":o[6]||(o[6]=e=>r.form.price=e),label:"Цена",type:"number",prefix:"₽",error:r.form.invalid("price"),"error-message":r.form.errors.price,onBlur:o[7]||(o[7]=e=>r.form.validate("price"))},null,8,["modelValue","error","error-message"]),a(r.UploadFileComponent,{modelValue:r.form.file,"onUpdate:modelValue":o[8]||(o[8]=e=>r.form.file=e),label:"Выбрать файл",error:r.form.invalid("file"),"error-message":r.form.errors.file,onChange:o[9]||(o[9]=e=>r.form.validate("file"))},null,8,["modelValue","error","error-message"])]),_:1}),a(P,{align:"right"},{default:u(()=>[a(c,{label:"Сохранить изменения",type:"submit",color:"primary",loading:r.form.processing,icon:"save"},null,8,["loading"]),a(c,{label:"Отмена",color:"grey-6",flat:"",onClick:r.cancel,icon:"close"})]),_:1})]),_:1})]),_:1},8,["valid"]),a(A,{showing:r.loading},{default:u(()=>[a(I,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})}const mr=F(j,[["render",q],["__file","EditPage.vue"]]);export{mr as default};
