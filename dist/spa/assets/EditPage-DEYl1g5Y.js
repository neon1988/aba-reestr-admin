import{a as I,Q as N}from"./QToolbar-BVmsPAij.js";import{u as P,a as m,b as k,Q as C}from"./useValidationNotification-DJ3O0idh.js";import{Q as A}from"./use-transition-4mtm_1Sm.js";import{Q as n}from"./QInput-Cq_516xi.js";import{c as T,Q as O}from"./files-DDZKinJd.js";import{Q as q}from"./QCardSection-CkOy_myj.js";import{O as z,P as j,r as d,o as G,ag as L,_ as M,S as V,T as y,U as u,V as l,Y as R,X as B,$ as Q,W as D}from"./index-B5fKhRmK.js";import{Q as W}from"./QCardActions-c7eJt_Iw.js";import{Q as X}from"./QCard-DxAewxH7.js";import{Q as Y}from"./QForm-CDspX6ko.js";import{Q as H,a as J}from"./QInnerLoading-DS7qhBsl.js";import{Q as K}from"./QPage-6isNs5ct.js";import{c as Z}from"./images-CvNZJFGB.js";import{b as h}from"./conferences-BYMg_lJD.js";import"./QChip-NOoku7Xo.js";import"./use-dark-CI_1RVc7.js";import"./format-DyQxkAtJ.js";import"./client-eJeKpGNL.js";import"./focus-manager-BJWzFvJg.js";const $=z({__name:"EditPage",props:{id:{}},setup(b,{expose:e}){e();const s=j(),r=b,i=P("patch",`/conferences/${r.id}`,{title:"",description:"",start_at:"",end_at:"",cover:"",stream_url:"",price:"",file:""}),t=d(!0),o=d(null),v=d(null),c=d(null),g=d(null);function p(a){return new Date(a).toISOString().slice(0,16)}const F=async()=>{try{const{data:a}=await h(r.id);a.data.start_at&&(a.data.start_at=p(a.data.start_at)),a.data.end_at&&(a.data.end_at=p(a.data.end_at)),a.data.cover&&(v.value=a.data.cover,a.data.cover=null),a.data.file&&(g.value=a.data.file,a.data.file=null),i.setData(a.data)}catch{m("Не удалось загрузить данные мероприятия","negative"),s.push("/conferences")}finally{t.value=!1}},w=async()=>{if(o.value){t.value=!0;try{const a=await Z(o.value);v.value=a.data,i.cover=a.data.path,m("Обложка успешно загружена","success")}finally{t.value=!1}}},E=async()=>{if(c.value){t.value=!0;try{const a=await T(c.value);g.value=a.data,i.file=a.data.path,m("Файл успешно загружен","success")}finally{t.value=!1}}},x=()=>{i.submit().then(()=>{m("Мероприятие успешно обновлён","success"),s.push("/conferences")}).catch(a=>{const{response:f}=a;if(f.status===422){const{opts:S}=k(f.data);L.create(S.value)}else m(f.data.message,"negative")})},U=()=>{s.push("/conferences")};G(()=>{F()});const _={router:s,props:r,form:i,loading:t,cover:o,previewCover:v,record:c,previewFile:g,formatDateForInput:p,loadConferenceData:F,uploadCover:w,uploadFile:E,submit:x,cancel:U};return Object.defineProperty(_,"__isScriptSetup",{enumerable:!1,value:!0}),_}}),rr={class:"row q-col-gutter-sm"},er={class:"col-6"},or={class:"col-6"};function ar(b,e,s,r,i,t){return V(),y(K,{padding:""},{default:u(()=>[l(N,null,{default:u(()=>[l(I,null,{default:u(()=>e[16]||(e[16]=[R("Редактирование мероприятия")])),_:1})]),_:1}),l(Y,{onSubmit:r.submit,valid:r.form.valid},{default:u(()=>[l(X,null,{default:u(()=>[l(q,null,{default:u(()=>[l(C,{label:"Выберите файл обложки",modelValue:r.cover,"onUpdate:modelValue":[e[0]||(e[0]=o=>r.cover=o),r.uploadCover],filled:"",color:"primary",error:r.form.invalid("cover"),"error-message":r.form.errors.cover,onChange:e[1]||(e[1]=o=>r.form.validate("cover"))},null,8,["modelValue","error","error-message"]),r.previewCover?(V(),y(A,{key:0,src:r.previewCover.url,"spinner-color":"white",class:"q-mb-sm",style:{height:"10rem","max-width":"10rem"}},null,8,["src"])):B("",!0),l(n,{modelValue:r.form.title,"onUpdate:modelValue":e[2]||(e[2]=o=>r.form.title=o),label:"Название мероприятия","lazy-rules":"",error:r.form.invalid("title"),"error-message":r.form.errors.title,onBlur:e[3]||(e[3]=o=>r.form.validate("title"))},null,8,["modelValue","error","error-message"]),l(n,{modelValue:r.form.description,"onUpdate:modelValue":e[4]||(e[4]=o=>r.form.description=o),label:"Описание мероприятия",type:"textarea",autogrow:"",error:r.form.invalid("description"),"error-message":r.form.errors.description,onBlur:e[5]||(e[5]=o=>r.form.validate("description"))},null,8,["modelValue","error","error-message"]),l(n,{modelValue:r.form.stream_url,"onUpdate:modelValue":e[6]||(e[6]=o=>r.form.stream_url=o),label:"Ссылка на трансляцию",error:r.form.invalid("stream_url"),"error-message":r.form.errors.stream_url,onBlur:e[7]||(e[7]=o=>r.form.validate("stream_url"))},null,8,["modelValue","error","error-message"]),l(n,{modelValue:r.form.price,"onUpdate:modelValue":e[8]||(e[8]=o=>r.form.price=o),label:"Цена",type:"number",prefix:"₽",error:r.form.invalid("price"),"error-message":r.form.errors.price,onBlur:e[9]||(e[9]=o=>r.form.validate("price"))},null,8,["modelValue","error","error-message"]),Q("div",rr,[Q("div",er,[l(n,{modelValue:r.form.start_at,"onUpdate:modelValue":e[10]||(e[10]=o=>r.form.start_at=o),label:"Дата начала",type:"datetime-local",error:r.form.invalid("start_at"),"error-message":r.form.errors.start_at,onBlur:e[11]||(e[11]=o=>r.form.validate("start_at"))},null,8,["modelValue","error","error-message"])]),Q("div",or,[l(n,{modelValue:r.form.end_at,"onUpdate:modelValue":e[12]||(e[12]=o=>r.form.end_at=o),label:"Дата окончания",type:"datetime-local",error:r.form.invalid("end_at"),"error-message":r.form.errors.end_at,onBlur:e[13]||(e[13]=o=>r.form.validate("end_at"))},null,8,["modelValue","error","error-message"])])]),l(C,{label:"Выберите файл",modelValue:r.record,"onUpdate:modelValue":[e[14]||(e[14]=o=>r.record=o),r.uploadFile],filled:"",color:"primary",error:r.form.invalid("file"),"error-message":r.form.errors.file,onChange:e[15]||(e[15]=o=>r.form.validate("file"))},null,8,["modelValue","error","error-message"]),r.previewFile?(V(),y(O,{key:1,"spinner-color":"white",src:r.previewFile.url},null,8,["src"])):B("",!0)]),_:1}),l(W,{align:"right"},{default:u(()=>[l(D,{label:"Сохранить изменения",type:"submit",color:"primary",loading:r.form.processing,icon:"save"},null,8,["loading"]),l(D,{label:"Отмена",color:"grey-6",flat:"",onClick:r.cancel,icon:"close"})]),_:1})]),_:1})]),_:1},8,["valid"]),l(J,{showing:r.loading},{default:u(()=>[l(H,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})}const Cr=M($,[["render",ar],["__file","EditPage.vue"]]);export{Cr as default};
