import{M as U,N as B,O as S,r as _,w as y,o as D,a8 as N,_ as w,Q as C,R as E,S as i,T as t,U as c,W as A,V as x}from"./index-BIoqSzkr.js";import{a as I,Q as T}from"./QToolbar-CNCw81R0.js";import{Q as l}from"./QInput-bEU_ILxu.js";import{Q as k}from"./QSelect-CUtVqXtZ.js";import{Q as z}from"./QForm-QZJhxQwP.js";import{Q as P,a as O}from"./QInnerLoading-CPQATF6z.js";import{Q as M}from"./QPage-C23wwPzr.js";import{a as Y,S as R}from"./SubscriptionLevelEnums-CjGkZn4x.js";import{d as j}from"./date-CRW3--p8.js";import{u as q,a as p,U as H,b as L}from"./UploadFileComponent-CAoCHX6r.js";import{I as G}from"./ImageComponent-Ag6g7Cqh.js";import"./use-dark-r3gEVHE7.js";import"./focus-manager-BJWzFvJg.js";import"./QChip-V35jz08L.js";import"./QItem-CSPSlXK2.js";import"./selection-CUW-9SO2.js";import"./QDialog-Dt0TXRkh.js";import"./use-transition-BxwYz9Om.js";import"./format-DyQxkAtJ.js";import"./client-BvPwPSEG.js";import"./QBadge-WlIihQSA.js";const W=U({__name:"EditPage",props:{id:{}},setup(v,{expose:r}){r();const m=B(),o=S(),s=_(null),n=v,e=q("patch",()=>`/users/${n.id}`,{photo:void 0,name:"",lastname:"",middlename:"",subscription_level:"",subscription_ends_at:""}),b=_(!0),d=async()=>{try{const{data:u}=await Y(n.id);u.data.subscription_ends_at&&(s.value=j.formatDate(u.data.subscription_ends_at,"YYYY-MM-DDTHH:mm")),e.setData(u.data)}catch{p("Не удалось загрузить пользователя","negative"),m.push("/users")}finally{b.value=!1}},Q=()=>{e.submit().then(()=>{p("Пользователь успешно обновлён","success"),o.user&&n.id===o.user.id&&o.fetchUser()}).catch(u=>{const{response:a}=u;if(a.status===422){const{opts:f}=L(a.data);N.create(f.value)}else p(a.data.message,"negative")})};function g(u){return Object.keys(u).filter(a=>Number.isNaN(Number(a))).map(a=>{const f=u[a];return a==="Free"&&(a="Без подписки"),a==="ParentsAndRelated"&&(a="Подписка A"),a==="Specialists"&&(a="Подписка B"),a==="Centers"&&(a="Подписка C"),{label:`${a}`,value:f}})}const F=g(R);y(()=>n.id,()=>{d()}),y(s,u=>{u?e.subscription_ends_at=new Date(u).toISOString():e.subscription_ends_at=""}),D(()=>{d()});const V={router:m,authStore:o,subscriptionEndsAt:s,props:n,form:e,loading:b,loadUserData:d,submit:Q,enumToOptions:g,options:F,UploadFileComponent:H,ImageComponent:G};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}});function J(v,r,m,o,s,n){return C(),E(M,{padding:""},{default:i(()=>[t(T,null,{default:i(()=>[t(c,{flat:"",icon:"arrow_back",onClick:r[0]||(r[0]=e=>o.router.go(-1))}),t(I,null,{default:i(()=>r[13]||(r[13]=[A("Редактировать профиль")])),_:1})]),_:1}),t(z,{onSubmit:o.submit,valid:o.form.valid},{default:i(()=>[t(o.UploadFileComponent,{modelValue:o.form.photo,"onUpdate:modelValue":r[1]||(r[1]=e=>o.form.photo=e),label:"Выбрать фото",error:o.form.invalid("photo"),"error-message":o.form.errors.photo,onChange:r[2]||(r[2]=e=>o.form.validate("photo"))},null,8,["modelValue","error","error-message"]),o.form.photo?(C(),E(o.ImageComponent,{key:0,class:"q-mb-md",url:o.form.photo.url,"max-width":200,"max-height":200},null,8,["url"])):x("",!0),t(l,{modelValue:o.form.name,"onUpdate:modelValue":r[3]||(r[3]=e=>o.form.name=e),outlined:"","lazy-rules":"",label:"Имя",error:o.form.invalid("name"),"error-message":o.form.errors.name,onBlur:r[4]||(r[4]=e=>o.form.validate("name"))},null,8,["modelValue","error","error-message"]),t(l,{modelValue:o.form.lastname,"onUpdate:modelValue":r[5]||(r[5]=e=>o.form.lastname=e),outlined:"","lazy-rules":"",label:"Фамилия",error:o.form.invalid("lastname"),"error-message":o.form.errors.lastname,onBlur:r[6]||(r[6]=e=>o.form.validate("lastname"))},null,8,["modelValue","error","error-message"]),t(l,{modelValue:o.form.middlename,"onUpdate:modelValue":r[7]||(r[7]=e=>o.form.middlename=e),outlined:"","lazy-rules":"",label:"Отчество",error:o.form.invalid("middlename"),"error-message":o.form.errors.middlename,onBlur:r[8]||(r[8]=e=>o.form.validate("middlename"))},null,8,["modelValue","error","error-message"]),t(k,{modelValue:o.form.subscription_level,"onUpdate:modelValue":r[9]||(r[9]=e=>o.form.subscription_level=e),options:o.options,label:"Тип подписки","lazy-rules":"",error:o.form.invalid("subscription_level"),"error-message":o.form.errors.subscription_level,onBlur:r[10]||(r[10]=e=>o.form.validate("subscription_level")),"emit-value":"","map-options":""},null,8,["modelValue","options","error","error-message"]),t(l,{modelValue:o.subscriptionEndsAt,"onUpdate:modelValue":r[11]||(r[11]=e=>o.subscriptionEndsAt=e),label:"Дата окончания подписки",type:"datetime-local","lazy-rules":"",error:o.form.invalid("subscription_ends_at"),"error-message":o.form.errors.subscription_ends_at,onBlur:r[12]||(r[12]=e=>o.form.validate("subscription_ends_at"))},null,8,["modelValue","error","error-message"]),t(c,{type:"submit",label:"Сохранить изменения",color:"primary",class:"full-width q-mt-md"})]),_:1},8,["valid"]),t(O,{showing:o.loading},{default:i(()=>[t(P,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})}const Vo=w(W,[["render",J],["__file","EditPage.vue"]]);export{Vo as default};
