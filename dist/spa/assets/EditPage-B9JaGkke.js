import{a as A,Q as x}from"./QToolbar-CI-8HeAt.js";import{M as Y,N as k,r as d,w as y,o as N,a8 as H,_ as T,Q as f,R as c,S as l,T as a,W as E,U as v,V as I,Y as _}from"./index-C2qAptKT.js";import{Q as M}from"./QBanner-BugwmxBh.js";import{Q as P}from"./use-transition-C5Fhv03G.js";import{Q as s}from"./QInput-DOL_am1W.js";import{Q as O}from"./QCardSection-6KYxq1ge.js";import{Q as q}from"./QCardActions-DhvInvN5.js";import{Q as z}from"./QCard-CST_RLfO.js";import{Q as R}from"./QForm-_Drk5vvD.js";import{Q as j,a as G}from"./QInnerLoading-Bw9KGBGa.js";import{Q as L}from"./QPage-CvtTgG3i.js";import{u as W,a as g,U as J,b as K}from"./UploadFileComponent-CQfdWiTW.js";import{d as B}from"./date-BnnLstCq.js";import{b as X,d as Z}from"./conferences-C0SdlQlX.js";import{u as h}from"./stat-store-DShDNWlF.js";import"./use-dark-DHM-lo7H.js";import"./focus-manager-BJWzFvJg.js";import"./client-CS_TtsJ-.js";import"./QBadge-CGypSZDF.js";import"./QChip-BN83K63w.js";import"./format-DyQxkAtJ.js";const $=Y({__name:"EditPage",props:{id:{}},setup(b,{expose:r}){r();const p=h(),e=k(),m=b,u=d(null),o=d(null),D=d(null),n=W("patch",()=>`/conferences/${m.id}`,{cover:void 0,title:"",description:"",start_at:"",end_at:"",registration_url:"",price:""}),i=d(!0),C=async()=>{try{const{data:t}=await X(m.id);u.value=t.data}catch{g("Не удалось загрузить данные мероприятия","negative"),e.push("/conferences")}finally{i.value=!1}},F=()=>{i.value=!0,n.submit().then(()=>{g("Мероприятие успешно обновлён","success"),e.push("/conferences")}).catch(t=>{const{response:V}=t;if(V.status===422){const{opts:U}=K(V.data);H.create(U.value)}else g(V.data.message,"negative")}).finally(()=>{i.value=!1})},w=async()=>{if(u.value){i.value=!0;try{const{data:t}=await Z(u.value.id);u.value=t.data,await p.fetchStats()}catch{g("Не удалось удалить мероприятие","negative")}finally{i.value=!1}}},S=()=>{e.push("/conferences")};y(u,()=>{u.value&&(n.setData(u.value),u.value.start_at&&(o.value=B.formatDate(u.value.start_at,"YYYY-MM-DDTHH:mm")),u.value.end_at&&(D.value=B.formatDate(u.value.end_at,"YYYY-MM-DDTHH:mm")))}),y(o,t=>{t?n.start_at=new Date(t).toISOString():n.start_at=""}),y(D,t=>{t?n.end_at=new Date(t).toISOString():n.end_at=""}),N(()=>{C()});const Q={statStore:p,router:e,props:m,conference:u,startAt:o,endAt:D,form:n,loading:i,loadConferenceData:C,submit:F,deleteHandler:w,cancel:S,UploadFileComponent:J};return Object.defineProperty(Q,"__isScriptSetup",{enumerable:!1,value:!0}),Q}}),ee={class:"row q-col-gutter-sm"},re={class:"col-6"},oe={class:"col-6"};function ae(b,r,p,e,m,u){return f(),c(L,{padding:""},{default:l(()=>[a(x,null,{default:l(()=>[a(A,null,{default:l(()=>r[14]||(r[14]=[E("Редактирование мероприятия")])),_:1})]),_:1}),e.conference&&e.conference.deleted_at?(f(),c(M,{key:0,"inline-actions":"",rounded:"",class:"bg-primary text-white"},{action:l(()=>[a(v,{flat:"",color:"white",label:"Восстановить",onClick:e.deleteHandler})]),default:l(()=>[r[15]||(r[15]=E(" Мероприятие успешно удалено "))]),_:1})):(f(),c(R,{key:1,onSubmit:e.submit,valid:e.form.valid},{default:l(()=>[a(z,null,{default:l(()=>[a(O,null,{default:l(()=>[a(e.UploadFileComponent,{modelValue:e.form.cover,"onUpdate:modelValue":r[0]||(r[0]=o=>e.form.cover=o),label:"Выбрать обложку",error:e.form.invalid("cover"),"error-message":e.form.errors.cover,onChange:r[1]||(r[1]=o=>e.form.validate("cover"))},null,8,["modelValue","error","error-message"]),e.form.cover?(f(),c(P,{key:0,src:e.form.cover.url,"spinner-color":"white",class:"q-mb-sm",style:{height:"10rem","max-width":"10rem"}},null,8,["src"])):I("",!0),a(s,{modelValue:e.form.title,"onUpdate:modelValue":r[2]||(r[2]=o=>e.form.title=o),label:"Название мероприятия","lazy-rules":"",error:e.form.invalid("title"),"error-message":e.form.errors.title,onBlur:r[3]||(r[3]=o=>e.form.validate("title"))},null,8,["modelValue","error","error-message"]),a(s,{modelValue:e.form.description,"onUpdate:modelValue":r[4]||(r[4]=o=>e.form.description=o),label:"Описание мероприятия",type:"textarea",autogrow:"",error:e.form.invalid("description"),"error-message":e.form.errors.description,onBlur:r[5]||(r[5]=o=>e.form.validate("description"))},null,8,["modelValue","error","error-message"]),a(s,{modelValue:e.form.registration_url,"onUpdate:modelValue":r[6]||(r[6]=o=>e.form.registration_url=o),label:"Ссылка на регистрацию",error:e.form.invalid("registration_url"),"error-message":e.form.errors.registration_url,onBlur:r[7]||(r[7]=o=>e.form.validate("registration_url"))},null,8,["modelValue","error","error-message"]),a(s,{modelValue:e.form.price,"onUpdate:modelValue":r[8]||(r[8]=o=>e.form.price=o),label:"Цена",type:"number",prefix:"₽",error:e.form.invalid("price"),"error-message":e.form.errors.price,onBlur:r[9]||(r[9]=o=>e.form.validate("price"))},null,8,["modelValue","error","error-message"]),_("div",ee,[_("div",re,[a(s,{modelValue:e.startAt,"onUpdate:modelValue":r[10]||(r[10]=o=>e.startAt=o),label:"Дата начала",type:"datetime-local",error:e.form.invalid("start_at"),"error-message":e.form.errors.start_at,onBlur:r[11]||(r[11]=o=>e.form.validate("start_at"))},null,8,["modelValue","error","error-message"])]),_("div",oe,[a(s,{modelValue:e.endAt,"onUpdate:modelValue":r[12]||(r[12]=o=>e.endAt=o),label:"Дата окончания",type:"datetime-local",error:e.form.invalid("end_at"),"error-message":e.form.errors.end_at,onBlur:r[13]||(r[13]=o=>e.form.validate("end_at"))},null,8,["modelValue","error","error-message"])])])]),_:1}),a(q,{align:"right"},{default:l(()=>[a(v,{label:"Сохранить изменения",type:"submit",color:"primary",loading:e.form.processing,icon:"save"},null,8,["loading"]),a(v,{label:"Отмена",color:"grey-6",flat:"",onClick:e.cancel,icon:"close"}),a(v,{flat:"",dense:"",icon:"delete",color:"red",onClick:e.deleteHandler})]),_:1})]),_:1})]),_:1},8,["valid"])),a(G,{showing:e.loading},{default:l(()=>[a(j,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})}const Be=T($,[["render",ae],["__file","EditPage.vue"]]);export{Be as default};
