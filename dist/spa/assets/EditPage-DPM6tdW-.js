import{a as D,Q as x}from"./QToolbar-CNCw81R0.js";import{M as E,N as U,r as b,w as S,o as I,a8 as T,_ as F,Q as m,R as s,S as u,T as a,W as y,U as d,V as N}from"./index-BIoqSzkr.js";import{Q as h}from"./QBanner-D7DUh8es.js";import{Q as g}from"./QInput-bEU_ILxu.js";import{Q as P}from"./QCardSection-LiU8wvIw.js";import{Q as W}from"./QCardActions-DEAdkGD4.js";import{Q as A}from"./QCard-Dop7LUhk.js";import{Q as H}from"./QForm-QZJhxQwP.js";import{Q as _,a as z}from"./QInnerLoading-CPQATF6z.js";import{Q as M}from"./QPage-C23wwPzr.js";import{u as R,a as f,U as j,b as q}from"./UploadFileComponent-CAoCHX6r.js";import{a as G,d as L}from"./worksheets-BuLxUcQn.js";import{u as O}from"./stat-store-HfXPcyHw.js";import{T as J}from"./TagInput-CwcY1eE4.js";import{I as K}from"./ImageComponent-Ag6g7Cqh.js";import"./use-dark-r3gEVHE7.js";import"./focus-manager-BJWzFvJg.js";import"./use-transition-BxwYz9Om.js";import"./client-BvPwPSEG.js";import"./QBadge-WlIihQSA.js";import"./QChip-V35jz08L.js";import"./format-DyQxkAtJ.js";import"./QItem-CSPSlXK2.js";import"./QSelect-CUtVqXtZ.js";import"./selection-CUW-9SO2.js";import"./QDialog-Dt0TXRkh.js";const X=E({__name:"EditPage",props:{id:{}},setup(c,{expose:r}){r();const p=O(),e=U(),n=c,l=b(null),o=R("patch",()=>`/worksheets/${n.id}`,{cover:void 0,title:"",description:"",price:"",file:void 0,tags:[]}),i=b(!0),Q=async()=>{i.value=!0;try{const{data:t}=await L(n.id);l.value=t.data}catch{f("Не удалось удалить материал","negative")}finally{i.value=!1}},C=async()=>{i.value=!0;try{const{data:t}=await G(n.id);l.value=t.data}catch{f("Не удалось загрузить данные материала","negative"),e.push("/worksheets"),await p.fetchStats()}finally{i.value=!1}},w=()=>{i.value=!0,o.submit().then(()=>{f("Данные материала успешно сохранены","success")}).catch(t=>{const{response:v}=t;if(v.status===422){const{opts:k}=q(v.data);T.create(k.value)}else f(v.data.message,"negative")}).finally(()=>{i.value=!1})},B=()=>{e.push("/worksheets")};S(l,()=>{l.value&&o.setData({...l.value,tags:l.value.tags?l.value.tags.map(t=>t.name):[]})}),I(()=>{C()});const V={statStore:p,router:e,props:n,worksheet:l,form:o,loading:i,deleteHandler:Q,loadWorksheetData:C,submit:w,cancel:B,UploadFileComponent:j,TagInput:J,ImageComponent:K};return Object.defineProperty(V,"__isScriptSetup",{enumerable:!1,value:!0}),V}});function Y(c,r,p,e,n,l){return m(),s(M,{padding:""},{default:u(()=>[a(x,null,{default:u(()=>[a(D,null,{default:u(()=>r[11]||(r[11]=[y("Редактирование материала")])),_:1})]),_:1}),e.worksheet&&e.worksheet.deleted_at?(m(),s(h,{key:0,"inline-actions":"",rounded:"",class:"bg-primary text-white"},{action:u(()=>[a(d,{flat:"",color:"white",label:"Восстановить",onClick:e.deleteHandler})]),default:u(()=>[r[12]||(r[12]=y(" Материал удален "))]),_:1})):(m(),s(H,{key:1,onSubmit:e.submit,valid:e.form.valid},{default:u(()=>[a(A,null,{default:u(()=>[a(P,null,{default:u(()=>[a(e.UploadFileComponent,{modelValue:e.form.cover,"onUpdate:modelValue":r[0]||(r[0]=o=>e.form.cover=o),label:"Выбрать обложку",error:e.form.invalid("cover"),"error-message":e.form.errors.cover,onChange:r[1]||(r[1]=o=>e.form.validate("cover"))},null,8,["modelValue","error","error-message"]),e.form.cover?(m(),s(e.ImageComponent,{key:0,url:e.form.cover.url,"spinner-color":"white",class:"q-mb-sm","max-width":200,"max-height":200},null,8,["url"])):N("",!0),a(g,{modelValue:e.form.title,"onUpdate:modelValue":r[2]||(r[2]=o=>e.form.title=o),label:"Название материала","lazy-rules":"",error:e.form.invalid("title"),"error-message":e.form.errors.title,onBlur:r[3]||(r[3]=o=>e.form.validate("title"))},null,8,["modelValue","error","error-message"]),a(g,{modelValue:e.form.description,"onUpdate:modelValue":r[4]||(r[4]=o=>e.form.description=o),label:"Описание материала",type:"textarea",autogrow:"",error:e.form.invalid("description"),"error-message":e.form.errors.description,onBlur:r[5]||(r[5]=o=>e.form.validate("description"))},null,8,["modelValue","error","error-message"]),a(g,{modelValue:e.form.price,"onUpdate:modelValue":r[6]||(r[6]=o=>e.form.price=o),label:"Цена",type:"number",prefix:"₽",error:e.form.invalid("price"),"error-message":e.form.errors.price,onBlur:r[7]||(r[7]=o=>e.form.validate("price"))},null,8,["modelValue","error","error-message"]),a(e.TagInput,{modelValue:e.form.tags,"onUpdate:modelValue":r[8]||(r[8]=o=>e.form.tags=o),label:"Выберите теги"},null,8,["modelValue"]),a(e.UploadFileComponent,{modelValue:e.form.file,"onUpdate:modelValue":r[9]||(r[9]=o=>e.form.file=o),label:"Выбрать файл",error:e.form.invalid("file"),"error-message":e.form.errors.file,onChange:r[10]||(r[10]=o=>e.form.validate("file"))},null,8,["modelValue","error","error-message"])]),_:1}),a(W,{align:"right"},{default:u(()=>[a(d,{label:"Сохранить изменения",type:"submit",color:"primary",loading:e.form.processing,icon:"save"},null,8,["loading"]),a(d,{label:"Отмена",color:"grey-6",flat:"",onClick:e.cancel,icon:"close"}),a(d,{flat:"",dense:"",icon:"delete",color:"red",onClick:e.deleteHandler})]),_:1})]),_:1})]),_:1},8,["valid"])),a(z,{showing:e.loading},{default:u(()=>[a(_,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})}const ke=F(X,[["render",Y],["__file","EditPage.vue"]]);export{ke as default};
