import{a as Y,Q as Z}from"./QToolbar-bxqVFmD_.js";import{Q as N}from"./QChip-W0XZ3hDA.js";import{Q as H}from"./QCardSection-DCd2w4Oo.js";import{r as T,a5 as $,f as m,a6 as S,h as k,G as ee,C as re,a7 as oe,g as le,z as P,c as ae,X as ue,L as te,M as ne,N as ie,o as se,a8 as me,_ as de,Q as p,R as V,S as s,T as t,W as F,V as B,U as z}from"./index-tVqCDBWc.js";import{Q as R}from"./QCardActions-BztyiOXS.js";import{Q as fe}from"./use-transition-DEfjUciZ.js";import{u as ve,a as ge,Q as f}from"./QInput-D_f2cMQV.js";import{Q as M}from"./QSelect-DQWWZkZ6.js";import{a as ce,u as pe}from"./use-dark-BIT_reWm.js";import{u as Ve,o as ye}from"./option-sizes-Bu6TzeE5.js";import{Q as be}from"./QCard-Rw1JuSIr.js";import{Q as Ce}from"./QForm-CoYThM_V.js";import{Q as Se,a as Be}from"./QInnerLoading-DGsgliZA.js";import{Q as ke}from"./QPage-D1QdM-xN.js";import{u as we}from"./use-quasar-sR5BCAzR.js";import{u as De,a as O,U as Qe,b as xe}from"./UploadFileComponent-DelgwhWC.js";import{a as Ee,b as Ie,r as Ue}from"./specialists-CZxWKCs0.js";import{api as Fe}from"./axios-Bx3js3hp.js";import{S as ze}from"./StatusEnums-Cpn04w7a.js";import{u as Ae}from"./stat-store-CE5o807L.js";import"./focus-manager-BJWzFvJg.js";import"./QItem-NUfpMue4.js";import"./selection-4jyEp4UX.js";import"./QDialog-BnU62fEy.js";import"./format-DyQxkAtJ.js";import"./client-CKXhsDOp.js";import"./QBadge-rjmiryxX.js";const qe={...pe,...oe,...ve,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:a=>a==="tf"||a==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},he=["update:modelValue"];function Ne(a,r){const{props:l,slots:e,emit:v,proxy:g}=le(),{$q:o}=g,w=ce(l,o),C=T(null),{refocusTargetEl:c,refocusTarget:E}=Ve(l,C),A=$(l,ye),y=m(()=>l.val!==void 0&&Array.isArray(l.modelValue)),D=m(()=>{const u=S(l.val);return y.value===!0?l.modelValue.findIndex(b=>S(b)===u):-1}),d=m(()=>y.value===!0?D.value!==-1:S(l.modelValue)===S(l.trueValue)),Q=m(()=>y.value===!0?D.value===-1:S(l.modelValue)===S(l.falseValue)),I=m(()=>d.value===!1&&Q.value===!1),q=m(()=>l.disable===!0?-1:l.tabindex||0),U=m(()=>`q-${a} cursor-pointer no-outline row inline no-wrap items-center`+(l.disable===!0?" disabled":"")+(w.value===!0?` q-${a}--dark`:"")+(l.dense===!0?` q-${a}--dense`:"")+(l.leftLabel===!0?" reverse":"")),i=m(()=>{const u=d.value===!0?"truthy":Q.value===!0?"falsy":"indet",b=l.color!==void 0&&(l.keepColor===!0||d.value===!0)?` text-${l.color}`:"";return`q-${a}__inner relative-position non-selectable q-${a}__inner--${u}${b}`}),n=m(()=>{const u={type:"checkbox"};return l.name!==void 0&&Object.assign(u,{".checked":d.value,"^checked":d.value===!0?"checked":void 0,name:l.name,value:y.value===!0?l.val:l.trueValue}),u}),x=ge(n),K=m(()=>{const u={tabindex:q.value,role:"switch","aria-label":l.label,"aria-checked":I.value===!0?"mixed":d.value===!0?"true":"false"};return l.disable===!0&&(u["aria-disabled"]="true"),u});function h(u){u!==void 0&&(P(u),E(u)),l.disable!==!0&&v("update:modelValue",W(),u)}function W(){if(y.value===!0){if(d.value===!0){const u=l.modelValue.slice();return u.splice(D.value,1),u}return l.modelValue.concat([l.val])}if(d.value===!0){if(l.toggleOrder!=="ft"||l.toggleIndeterminate===!1)return l.falseValue}else if(Q.value===!0){if(l.toggleOrder==="ft"||l.toggleIndeterminate===!1)return l.trueValue}else return l.toggleOrder!=="ft"?l.trueValue:l.falseValue;return l.indeterminateValue}function _(u){(u.keyCode===13||u.keyCode===32)&&P(u)}function X(u){(u.keyCode===13||u.keyCode===32)&&h(u)}const J=r(d,I);return Object.assign(g,{toggle:h}),()=>{const u=J();l.disable!==!0&&x(u,"unshift",` q-${a}__native absolute q-ma-none q-pa-none`);const b=[k("div",{class:i.value,style:A.value,"aria-hidden":"true"},u)];c.value!==null&&b.push(c.value);const j=l.label!==void 0?ee(e.default,[l.label]):re(e.default);return j!==void 0&&b.push(k("div",{class:`q-${a}__label q-anchor--skip`},j)),k("div",{ref:C,class:U.value,...K.value,onClick:h,onKeydown:_,onKeyup:X},b)}}const L=ae({name:"QToggle",props:{...qe,icon:String,iconColor:String},emits:he,setup(a){function r(l,e){const v=m(()=>(l.value===!0?a.checkedIcon:e.value===!0?a.indeterminateIcon:a.uncheckedIcon)||a.icon),g=m(()=>l.value===!0?a.iconColor:null);return()=>[k("div",{class:"q-toggle__track"}),k("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},v.value!==void 0?[k(ue,{name:v.value,color:g.value})]:void 0)]}return Ne("toggle",r)}});var G=(a=>(a[a.Secondary=1]="Secondary",a[a.Vocational=2]="Vocational",a[a.IncompleteHigher=3]="IncompleteHigher",a[a.Higher=4]="Higher",a[a.Master=5]="Master",a[a.Doctorate=6]="Doctorate",a))(G||{});const Oe=()=>Fe.get("/countries",{}),Te=te("world",{state:()=>({loading:!1,countries:[]}),actions:{async fetchCountries(){this.loading=!0;try{const a=await Oe();this.countries=a.data.data}catch{}finally{this.loading=!1}}}}),je=ne({__name:"EditPage",props:{id:{}},setup(a,{expose:r}){r();const l=we(),e=Te(),v=Ae(),g=ie(),o=T(null),w=a,C=De("patch",()=>`/specialists/${w.id}`,{photo:void 0,name:"",lastname:"",middlename:"",country:"",region:"",city:"",education:"",phone:"",center_name:"",curator:"",supervisor:"",professional_interests:"",show_email:!1,show_phone:!1,telegram_profile:"",files:[],additional_courses:[]}),c=T(!0),E=async()=>{try{const{data:i}=await Ee(w.id);C.setData(i.data),o.value=i.data}catch{O("Не удалось загрузить данные специалиста","negative"),g.push("/specialists")}finally{c.value=!1}},A=()=>{C.submit().then(()=>{O("Профиль специалиста успешно обновлён","success")}).catch(i=>{const{response:n}=i;if(n.status===422){const{opts:x}=xe(n.data);me.create(x.value)}else O(n.data.message,"negative")})};function y(i){return Object.keys(i).filter(n=>Number.isNaN(Number(n))).map(n=>{const x=i[n];return n==="Secondary"&&(n="Среднее"),n==="Vocational"&&(n="Среднее специальное"),n==="IncompleteHigher"&&(n="Неполное высшее"),n==="Higher"&&(n="Высшее"),n==="Master"&&(n="Магистр"),n==="Doctorate"&&(n="Доктор наук"),{label:`${n}`,value:x}})}const D=async()=>{if(o.value){c.value=!0;try{const i=await Ie(o.value.id);o.value=i.data.specialist,l.notify({message:i.data.message,color:"positive",position:"top",timeout:3e3}),await v.fetchStats()}finally{c.value=!1}}},d=async()=>{if(o.value){c.value=!0;try{const i=await Ue(o.value.id);o.value=i.data.specialist,l.notify({message:i.data.message,color:"positive",position:"top",timeout:3e3}),await v.fetchStats()}finally{c.value=!1}}},Q=y(G),I=m(()=>e.countries.map(i=>({label:i.localized_name,value:i.name}))),q=()=>{g.push("/specialists")};se(()=>{E(),e.fetchCountries()});const U={$q:l,worldStore:e,statStore:v,router:g,specialist:o,props:w,form:C,loading:c,loadSpecialistData:E,submit:A,enumToOptions:y,approveSpecialistHandler:D,rejectSpecialistHandler:d,options:Q,selectCountryOptions:I,cancel:q,UploadFileComponent:Qe,get StatusEnum(){return ze}};return Object.defineProperty(U,"__isScriptSetup",{enumerable:!1,value:!0}),U}});function He(a,r,l,e,v,g){return p(),V(ke,{padding:""},{default:s(()=>[t(Z,null,{default:s(()=>[t(Y,null,{default:s(()=>r[36]||(r[36]=[F("Редактирование специалиста")])),_:1})]),_:1}),e.specialist?(p(),V(H,{key:0},{default:s(()=>[e.specialist.status===e.StatusEnum.Accepted?(p(),V(N,{key:0,color:"green","text-color":"white",icon:"check"},{default:s(()=>r[37]||(r[37]=[F(" Подтверждён ")])),_:1})):e.specialist.status===e.StatusEnum.Rejected?(p(),V(N,{key:1,color:"red","text-color":"white",icon:"block"},{default:s(()=>r[38]||(r[38]=[F(" Отклонён ")])),_:1})):e.specialist.status===e.StatusEnum.OnReview?(p(),V(N,{key:2,color:"orange","text-color":"white",icon:"hourglass_empty"},{default:s(()=>r[39]||(r[39]=[F(" На проверке ")])),_:1})):B("",!0)]),_:1})):B("",!0),e.specialist?(p(),V(R,{key:1},{default:s(()=>[e.specialist.status!=e.StatusEnum.Accepted&&!e.loading?(p(),V(z,{key:0,label:"Подтвердить",color:"green",onClick:e.approveSpecialistHandler})):B("",!0),e.specialist.status!=e.StatusEnum.Rejected&&!e.loading?(p(),V(z,{key:1,label:"Отклонить",color:"red",onClick:e.rejectSpecialistHandler})):B("",!0)]),_:1})):B("",!0),t(Ce,{onSubmit:e.submit,valid:e.form.valid},{default:s(()=>[t(be,null,{default:s(()=>[t(H,null,{default:s(()=>[t(e.UploadFileComponent,{modelValue:e.form.photo,"onUpdate:modelValue":r[0]||(r[0]=o=>e.form.photo=o),label:"Выбрать фото",error:e.form.invalid("photo"),"error-message":e.form.errors.photo,onChange:r[1]||(r[1]=o=>e.form.validate("photo"))},null,8,["modelValue","error","error-message"]),e.form.photo?(p(),V(fe,{key:0,src:e.form.photo.url,"spinner-color":"white",class:"q-mb-sm",style:{height:"10rem","max-width":"10rem"}},null,8,["src"])):B("",!0),t(f,{modelValue:e.form.lastname,"onUpdate:modelValue":r[2]||(r[2]=o=>e.form.lastname=o),label:"Фамилия","lazy-rules":"",error:e.form.invalid("lastname"),"error-message":e.form.errors.lastname,onBlur:r[3]||(r[3]=o=>e.form.validate("lastname"))},null,8,["modelValue","error","error-message"]),t(f,{modelValue:e.form.name,"onUpdate:modelValue":r[4]||(r[4]=o=>e.form.name=o),label:"Имя","lazy-rules":"",error:e.form.invalid("name"),"error-message":e.form.errors.name,onBlur:r[5]||(r[5]=o=>e.form.validate("name"))},null,8,["modelValue","error","error-message"]),t(f,{modelValue:e.form.middlename,"onUpdate:modelValue":r[6]||(r[6]=o=>e.form.middlename=o),label:"Отчество","lazy-rules":"",error:e.form.invalid("middlename"),"error-message":e.form.errors.middlename,onBlur:r[7]||(r[7]=o=>e.form.validate("middlename"))},null,8,["modelValue","error","error-message"]),t(M,{modelValue:e.form.country,"onUpdate:modelValue":r[8]||(r[8]=o=>e.form.country=o),options:e.selectCountryOptions,label:"Страна","lazy-rules":"",error:e.form.invalid("country"),"error-message":e.form.errors.country,onBlur:r[9]||(r[9]=o=>e.form.validate("country")),"emit-value":"","map-options":""},null,8,["modelValue","options","error","error-message"]),t(f,{modelValue:e.form.region,"onUpdate:modelValue":r[10]||(r[10]=o=>e.form.region=o),label:"Регион","lazy-rules":"",error:e.form.invalid("region"),"error-message":e.form.errors.region,onBlur:r[11]||(r[11]=o=>e.form.validate("region"))},null,8,["modelValue","error","error-message"]),t(f,{modelValue:e.form.city,"onUpdate:modelValue":r[12]||(r[12]=o=>e.form.city=o),label:"Город","lazy-rules":"",error:e.form.invalid("city"),"error-message":e.form.errors.city,onBlur:r[13]||(r[13]=o=>e.form.validate("city"))},null,8,["modelValue","error","error-message"]),t(M,{modelValue:e.form.education,"onUpdate:modelValue":r[14]||(r[14]=o=>e.form.education=o),options:e.options,label:"Образование","lazy-rules":"",error:e.form.invalid("education"),"error-message":e.form.errors.education,onBlur:r[15]||(r[15]=o=>e.form.validate("education")),"emit-value":"","map-options":""},null,8,["modelValue","options","error","error-message"]),t(f,{modelValue:e.form.phone,"onUpdate:modelValue":r[16]||(r[16]=o=>e.form.phone=o),label:"Телефон","lazy-rules":"",error:e.form.invalid("phone"),"error-message":e.form.errors.phone,onBlur:r[17]||(r[17]=o=>e.form.validate("phone"))},null,8,["modelValue","error","error-message"]),t(f,{modelValue:e.form.center_name,"onUpdate:modelValue":r[18]||(r[18]=o=>e.form.center_name=o),label:"Название центра","lazy-rules":"",error:e.form.invalid("center_name"),"error-message":e.form.errors.center_name,onBlur:r[19]||(r[19]=o=>e.form.validate("center_name"))},null,8,["modelValue","error","error-message"]),t(f,{modelValue:e.form.curator,"onUpdate:modelValue":r[20]||(r[20]=o=>e.form.curator=o),label:"Куратор","lazy-rules":"",error:e.form.invalid("curator"),"error-message":e.form.errors.curator,onBlur:r[21]||(r[21]=o=>e.form.validate("curator"))},null,8,["modelValue","error","error-message"]),t(f,{modelValue:e.form.supervisor,"onUpdate:modelValue":r[22]||(r[22]=o=>e.form.supervisor=o),label:"Руководитель","lazy-rules":"",error:e.form.invalid("supervisor"),"error-message":e.form.errors.supervisor,onBlur:r[23]||(r[23]=o=>e.form.validate("supervisor"))},null,8,["modelValue","error","error-message"]),t(f,{modelValue:e.form.professional_interests,"onUpdate:modelValue":r[24]||(r[24]=o=>e.form.professional_interests=o),label:"Профессиональные интересы","lazy-rules":"",error:e.form.invalid("professional_interests"),"error-message":e.form.errors.professional_interests,onBlur:r[25]||(r[25]=o=>e.form.validate("professional_interests"))},null,8,["modelValue","error","error-message"]),t(L,{modelValue:e.form.show_email,"onUpdate:modelValue":r[26]||(r[26]=o=>e.form.show_email=o),label:"Показывать email",error:e.form.invalid("show_email"),"error-message":e.form.errors.show_email,onBlur:r[27]||(r[27]=o=>e.form.validate("show_email"))},null,8,["modelValue","error","error-message"]),t(L,{modelValue:e.form.show_phone,"onUpdate:modelValue":r[28]||(r[28]=o=>e.form.show_phone=o),label:"Показывать телефон",error:e.form.invalid("show_phone"),"error-message":e.form.errors.show_phone,onBlur:r[29]||(r[29]=o=>e.form.validate("show_phone"))},null,8,["modelValue","error","error-message"]),t(f,{modelValue:e.form.telegram_profile,"onUpdate:modelValue":r[30]||(r[30]=o=>e.form.telegram_profile=o),label:"Telegram профиль","lazy-rules":"",error:e.form.invalid("telegram_profile"),"error-message":e.form.errors.telegram_profile,onBlur:r[31]||(r[31]=o=>e.form.validate("telegram_profile"))},null,8,["modelValue","error","error-message"]),t(e.UploadFileComponent,{modelValue:e.form.files,"onUpdate:modelValue":r[32]||(r[32]=o=>e.form.files=o),label:"Документы об образовании",error:e.form.invalid("files"),"error-message":e.form.errors.files,onChange:r[33]||(r[33]=o=>e.form.validate("files")),multiple:""},null,8,["modelValue","error","error-message"]),t(e.UploadFileComponent,{modelValue:e.form.additional_courses,"onUpdate:modelValue":r[34]||(r[34]=o=>e.form.additional_courses=o),label:"Дополнительные курсы",error:e.form.invalid("additional_courses"),"error-message":e.form.errors.additional_courses,onChange:r[35]||(r[35]=o=>e.form.validate("additional_courses")),multiple:""},null,8,["modelValue","error","error-message"])]),_:1}),t(R,{align:"right"},{default:s(()=>[t(z,{label:"Сохранить изменения",type:"submit",color:"primary",loading:e.form.processing,icon:"save"},null,8,["loading"]),t(z,{label:"Отмена",color:"grey-6",flat:"",onClick:e.cancel,icon:"close"})]),_:1})]),_:1})]),_:1},8,["valid"]),t(Be,{showing:e.loading},{default:s(()=>[t(Se,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})}const gr=de(je,[["render",He],["__file","EditPage.vue"]]);export{gr as default};
