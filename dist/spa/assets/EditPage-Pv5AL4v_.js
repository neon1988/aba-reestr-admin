import{a as A,Q as F}from"./QToolbar-fsbRQWuM.js";import{M as Y,N as k,r as s,w as V,o as I,a8 as N,_ as H,Q as f,R as v,S as t,T as a,W as C,U as g,V as T,Y as _}from"./index-Bc0R355J.js";import{Q as M}from"./QBanner-B7nCSk7H.js";import{Q as m}from"./QInput-KLQz9GaB.js";import{Q as P}from"./QCardSection-CMAUuuie.js";import{Q as W}from"./QCardActions-vgdUSFOZ.js";import{Q as q}from"./QCard-DxBq4jcz.js";import{Q as O}from"./QForm-CO8bnY9c.js";import{Q as z,a as R}from"./QInnerLoading-BHVqACUk.js";import{Q as j}from"./QPage-SQbvXMJf.js";import{u as G,a as c,U as L,b as J}from"./UploadFileComponent-C-GoAgnv.js";import{d as Q}from"./date-BaulYPxB.js";import{b as K,d as X}from"./webinars-Byp4KWIx.js";import{u as Z}from"./stat-store-D9nhWtHV.js";import{I as h}from"./ImageComponent-m-e6C0wA.js";import"./use-dark-B6AwncSa.js";import"./focus-manager-zjdVGI5d.js";import"./ImageFullscreen-BMuWzocu.js";import"./client-5NLhBQvt.js";import"./QBadge-Ba0Rv4Xu.js";import"./QChip-BcyO6mis.js";import"./format-DyQxkAtJ.js";const $=Y({__name:"EditPage",props:{id:{}},setup(w,{expose:e}){e();const b=Z(),r=k(),d=w,u=s(null),o=s(null),p=s(null),n=G("patch",()=>`/webinars/${d.id}`,{title:"",description:"",start_at:"",end_at:"",cover:void 0,stream_url:"",price:"",record_file:void 0}),i=s(!0),y=async()=>{i.value=!0;try{const{data:l}=await K(d.id);u.value=l.data}catch{c("Не удалось загрузить данные вебинара","negative"),r.push("/webinars")}finally{i.value=!1}},E=()=>{i.value=!0,n.submit().then(()=>{c("Вебинар успешно обновлён","success"),r.push("/webinars")}).catch(l=>{const{response:D}=l;if(D.status===422){const{opts:x}=J(D.data);N.create(x.value)}else c(D.data.message,"negative")}).finally(()=>{i.value=!1})},S=async()=>{i.value=!0;try{const{data:l}=await X(d.id);u.value=l.data,await b.fetchStats()}catch{c("Не удалось удалить вебинар","negative")}finally{i.value=!1}},U=()=>{r.push("/webinars")};V(u,()=>{u.value&&(n.setData(u.value),u.value.start_at&&(o.value=Q.formatDate(u.value.start_at,"YYYY-MM-DDTHH:mm")),u.value.end_at&&(p.value=Q.formatDate(u.value.end_at,"YYYY-MM-DDTHH:mm")))}),V(o,l=>{l?n.start_at=new Date(l).toISOString():n.start_at=""}),V(p,l=>{l?n.end_at=new Date(l).toISOString():n.end_at=""}),I(()=>{y()});const B={statStore:b,router:r,props:d,webinar:u,startAt:o,endAt:p,form:n,loading:i,loadWebinarData:y,submit:E,deleteHandler:S,cancel:U,UploadFileComponent:L,ImageComponent:h};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),rr={class:"row q-col-gutter-sm"},er={class:"col-6"},or={class:"col-6"};function ar(w,e,b,r,d,u){return f(),v(j,{padding:""},{default:t(()=>[a(F,null,{default:t(()=>[a(A,null,{default:t(()=>e[16]||(e[16]=[C("Редактирование вебинара")])),_:1})]),_:1}),r.webinar&&r.webinar.deleted_at?(f(),v(M,{key:0,"inline-actions":"",rounded:"",class:"bg-primary text-white"},{action:t(()=>[a(g,{flat:"",color:"white",label:"Восстановить",onClick:r.deleteHandler})]),default:t(()=>[e[17]||(e[17]=C(" Вебинар успешно удален "))]),_:1})):(f(),v(O,{key:1,onSubmit:r.submit,valid:r.form.valid},{default:t(()=>[a(q,null,{default:t(()=>[a(P,null,{default:t(()=>[a(r.UploadFileComponent,{modelValue:r.form.cover,"onUpdate:modelValue":e[0]||(e[0]=o=>r.form.cover=o),label:"Выбрать обложку",error:r.form.invalid("cover"),"error-message":r.form.errors.cover,onChange:e[1]||(e[1]=o=>r.form.validate("cover"))},null,8,["modelValue","error","error-message"]),r.form.cover?(f(),v(r.ImageComponent,{key:0,url:r.form.cover.url,"spinner-color":"white",class:"q-mb-sm",fit:"scale-down","allow-fullscreen":"","quasar-component":"","max-width":200,"max-height":200},null,8,["url"])):T("",!0),a(m,{modelValue:r.form.title,"onUpdate:modelValue":e[2]||(e[2]=o=>r.form.title=o),label:"Название вебинара","lazy-rules":"",error:r.form.invalid("title"),"error-message":r.form.errors.title,onBlur:e[3]||(e[3]=o=>r.form.validate("title"))},null,8,["modelValue","error","error-message"]),a(m,{modelValue:r.form.description,"onUpdate:modelValue":e[4]||(e[4]=o=>r.form.description=o),label:"Описание вебинара",type:"textarea",autogrow:"",error:r.form.invalid("description"),"error-message":r.form.errors.description,onBlur:e[5]||(e[5]=o=>r.form.validate("description"))},null,8,["modelValue","error","error-message"]),a(m,{modelValue:r.form.stream_url,"onUpdate:modelValue":e[6]||(e[6]=o=>r.form.stream_url=o),label:"Ссылка на трансляцию",error:r.form.invalid("stream_url"),"error-message":r.form.errors.stream_url,onBlur:e[7]||(e[7]=o=>r.form.validate("stream_url"))},null,8,["modelValue","error","error-message"]),a(m,{modelValue:r.form.price,"onUpdate:modelValue":e[8]||(e[8]=o=>r.form.price=o),label:"Цена",type:"number",prefix:"₽",error:r.form.invalid("price"),"error-message":r.form.errors.price,onBlur:e[9]||(e[9]=o=>r.form.validate("price"))},null,8,["modelValue","error","error-message"]),_("div",rr,[_("div",er,[a(m,{modelValue:r.startAt,"onUpdate:modelValue":e[10]||(e[10]=o=>r.startAt=o),label:"Дата начала",type:"datetime-local",error:r.form.invalid("start_at"),"error-message":r.form.errors.start_at,onBlur:e[11]||(e[11]=o=>r.form.validate("start_at"))},null,8,["modelValue","error","error-message"])]),_("div",or,[a(m,{modelValue:r.endAt,"onUpdate:modelValue":e[12]||(e[12]=o=>r.endAt=o),label:"Дата окончания",type:"datetime-local",error:r.form.invalid("end_at"),"error-message":r.form.errors.end_at,onBlur:e[13]||(e[13]=o=>r.form.validate("end_at"))},null,8,["modelValue","error","error-message"])])]),a(r.UploadFileComponent,{modelValue:r.form.record_file,"onUpdate:modelValue":e[14]||(e[14]=o=>r.form.record_file=o),label:"Выбрать файл",error:r.form.invalid("record_file"),"error-message":r.form.errors.record_file,onChange:e[15]||(e[15]=o=>r.form.validate("record_file"))},null,8,["modelValue","error","error-message"])]),_:1}),a(W,{align:"right"},{default:t(()=>[a(g,{label:"Сохранить изменения",type:"submit",color:"primary",loading:r.form.processing,icon:"save"},null,8,["loading"]),a(g,{label:"Отмена",color:"grey-6",flat:"",onClick:r.cancel,icon:"close"}),a(g,{flat:"",dense:"",icon:"delete",color:"red",onClick:r.deleteHandler})]),_:1})]),_:1})]),_:1},8,["valid"])),a(R,{showing:r.loading},{default:t(()=>[a(z,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})}const Er=H($,[["render",ar],["__file","EditPage.vue"]]);export{Er as default};
