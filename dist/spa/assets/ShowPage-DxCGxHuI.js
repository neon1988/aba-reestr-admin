import{M as C,N as x,r as p,o as V,_ as A,Q as n,R as i,S as l,V as s,T as a,U as d,W as f}from"./index-3CeRA5gR.js";import{a as D,Q as P}from"./QToolbar-BjnzGdn8.js";import{Q as g}from"./QCardSection-Cap8E1vc.js";import{Q as v}from"./QChip-DqwOLBB-.js";import{Q as h}from"./QInput-CHFEuogG.js";import{Q as j}from"./QCardActions-BcY71p0D.js";import{Q as U}from"./QCard-qYkn4Jno.js";import{Q as H,a as R}from"./QInnerLoading-Dvj6N35R.js";import{Q as T}from"./QPage-Cs4qjIpF.js";import{u as F}from"./use-quasar-CrdsCkZM.js";import{a as N,u as I,b as q,r as z}from"./bulletins-Dj5VrEjr.js";import{S as M}from"./StatusEnums-Cpn04w7a.js";import{u as O}from"./stat-store-DlnDfx8a.js";import{U as G}from"./UserPhoto-CBIONOAp.js";import"./use-dark-Dg6r_JxN.js";import"./focus-manager-BJWzFvJg.js";import"./use-transition-By_GSWr4.js";import"./ImageFullscreen-BSdtIV-9.js";import"./QDialog-tWG2j4rv.js";const L=C({__name:"ShowPage",props:{id:{type:String,required:!0}},setup(y,{expose:t}){t();const c=y,e=F(),b=x(),m=O(),u=p(!1),o=p(null),E=p(!1),w=async()=>{if(o.value){u.value=!0;try{const r=await I(o.value.id,{text:o.value.text});o.value=r.data.bulletin,E.value=!1,e.notify({message:"Объявление успешно обновлено!",color:"positive",position:"top",timeout:3e3})}catch{e.notify({message:"Ошибка при обновлении объявления!",color:"negative",position:"top",timeout:3e3})}finally{u.value=!1}}},S=async r=>{u.value=!0;try{const _=await N(r);o.value=_.data.data}finally{u.value=!1}},k=async()=>{if(o.value){u.value=!0;try{const r=await q(o.value.id);o.value=r.data.bulletin,e.notify({message:r.data.message,color:"positive",position:"top",timeout:3e3}),await m.fetchStats()}finally{u.value=!1}}},B=async()=>{if(o.value){u.value=!0;try{const r=await z(o.value.id);o.value=r.data.bulletin,e.notify({message:r.data.message,color:"positive",position:"top",timeout:3e3}),await m.fetchStats()}finally{u.value=!1}}};V(()=>{S(c.id)});const Q={props:c,$q:e,router:b,statStore:m,loading:u,bulletin:o,isEditing:E,saveEditedBulletin:w,fetchBulletinHandler:S,approveBulletinHandler:k,rejectBulletinHandler:B,get StatusEnum(){return M},UserPhoto:G};return Object.defineProperty(Q,"__isScriptSetup",{enumerable:!1,value:!0}),Q}});function W(y,t,c,e,b,m){return e.bulletin?(n(),i(T,{key:0,padding:""},{default:l(()=>[a(P,null,{default:l(()=>[a(d,{flat:"",icon:"arrow_back",onClick:t[0]||(t[0]=u=>e.router.go(-1))}),a(D,null,{default:l(()=>t[4]||(t[4]=[f("Объявление")])),_:1})]),_:1}),a(U,{bordered:""},{default:l(()=>[a(g,null,{default:l(()=>[a(e.UserPhoto,{modelValue:e.bulletin.creator,"onUpdate:modelValue":t[1]||(t[1]=u=>e.bulletin.creator=u),fullscreen:!0,size:"6rem",width:224,height:224,class:"cursor-pointer"},null,8,["modelValue"])]),_:1}),a(g,null,{default:l(()=>[e.bulletin.status===e.StatusEnum.Accepted?(n(),i(v,{key:0,color:"green","text-color":"white",icon:"check"},{default:l(()=>t[5]||(t[5]=[f(" Подтверждёно ")])),_:1})):e.bulletin.status===e.StatusEnum.Rejected?(n(),i(v,{key:1,color:"red","text-color":"white",icon:"block"},{default:l(()=>t[6]||(t[6]=[f(" Отклонёно ")])),_:1})):e.bulletin.status===e.StatusEnum.OnReview?(n(),i(v,{key:2,color:"orange","text-color":"white",icon:"hourglass_empty"},{default:l(()=>t[7]||(t[7]=[f(" На проверке ")])),_:1})):s("",!0)]),_:1}),a(g,null,{default:l(()=>[a(h,{filled:"",modelValue:e.bulletin.text,"onUpdate:modelValue":t[2]||(t[2]=u=>e.bulletin.text=u),readonly:!e.isEditing,autogrow:"",type:"textarea"},null,8,["modelValue","readonly"])]),_:1}),a(j,null,{default:l(()=>[e.bulletin.status!=e.StatusEnum.Accepted&&!e.loading&&!e.isEditing?(n(),i(d,{key:0,label:"Подтвердить",color:"green",onClick:e.approveBulletinHandler})):s("",!0),e.bulletin.status!=e.StatusEnum.Rejected&&!e.loading&&!e.isEditing?(n(),i(d,{key:1,label:"Отклонить",color:"red",onClick:e.rejectBulletinHandler})):s("",!0),!e.loading&&!e.isEditing?(n(),i(d,{key:2,label:"Редактировать",color:"blue",onClick:t[3]||(t[3]=u=>e.isEditing=!0)})):s("",!0),!e.loading&&e.isEditing?(n(),i(d,{key:3,label:"Сохранить",color:"blue",onClick:e.saveEditedBulletin})):s("",!0)]),_:1})]),_:1}),a(R,{showing:e.loading},{default:l(()=>[a(H,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})):s("",!0)}const ce=A(L,[["render",W],["__file","ShowPage.vue"]]);export{ce as default};
