import{a as x,Q as A}from"./QToolbar-fsbRQWuM.js";import{M as Y,N as k,r as d,w as D,o as I,a8 as N,_ as H,Q as f,R as v,S as t,T as a,W as F,U as c,V as T,Y as b}from"./index-Bc0R355J.js";import{Q as M}from"./QBanner-B7nCSk7H.js";import{Q as m}from"./QInput-KLQz9GaB.js";import{Q as P}from"./QCardSection-CMAUuuie.js";import{Q as q}from"./QCardActions-vgdUSFOZ.js";import{Q as O}from"./QCard-DxBq4jcz.js";import{Q as z}from"./QForm-CO8bnY9c.js";import{Q as R,a as j}from"./QInnerLoading-BHVqACUk.js";import{Q as G}from"./QPage-SQbvXMJf.js";import{u as L,a as g,U as W,b as J}from"./UploadFileComponent-C-GoAgnv.js";import{d as _}from"./date-BaulYPxB.js";import{b as K,d as X}from"./conferences-C1t8kUZL.js";import{u as Z}from"./stat-store-D9nhWtHV.js";import{I as h}from"./ImageComponent-m-e6C0wA.js";import"./use-dark-B6AwncSa.js";import"./focus-manager-zjdVGI5d.js";import"./ImageFullscreen-BMuWzocu.js";import"./client-5NLhBQvt.js";import"./QBadge-Ba0Rv4Xu.js";import"./QChip-BcyO6mis.js";import"./format-DyQxkAtJ.js";const $=Y({__name:"EditPage",props:{id:{}},setup(y,{expose:r}){r();const p=Z(),e=k(),s=y,u=d(null),o=d(null),V=d(null),n=L("patch",()=>`/conferences/${s.id}`,{cover:void 0,title:"",description:"",start_at:"",end_at:"",registration_url:"",price:"",file:void 0}),i=d(!0),Q=async()=>{try{const{data:l}=await K(s.id);u.value=l.data}catch{g("Не удалось загрузить данные мероприятия","negative"),e.push("/conferences")}finally{i.value=!1}},E=()=>{i.value=!0,n.submit().then(()=>{g("Мероприятие успешно обновлён","success"),e.push("/conferences")}).catch(l=>{const{response:C}=l;if(C.status===422){const{opts:U}=J(C.data);N.create(U.value)}else g(C.data.message,"negative")}).finally(()=>{i.value=!1})},w=async()=>{if(u.value){i.value=!0;try{const{data:l}=await X(u.value.id);u.value=l.data,await p.fetchStats()}catch{g("Не удалось удалить мероприятие","negative")}finally{i.value=!1}}},S=()=>{e.push("/conferences")};D(u,()=>{u.value&&(n.setData(u.value),u.value.start_at&&(o.value=_.formatDate(u.value.start_at,"YYYY-MM-DDTHH:mm")),u.value.end_at&&(V.value=_.formatDate(u.value.end_at,"YYYY-MM-DDTHH:mm")))}),D(o,l=>{l?n.start_at=new Date(l).toISOString():n.start_at=""}),D(V,l=>{l?n.end_at=new Date(l).toISOString():n.end_at=""}),I(()=>{Q()});const B={statStore:p,router:e,props:s,conference:u,startAt:o,endAt:V,form:n,loading:i,loadConferenceData:Q,submit:E,deleteHandler:w,cancel:S,UploadFileComponent:W,ImageComponent:h};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),ee={class:"row q-col-gutter-sm"},re={class:"col-6"},oe={class:"col-6"};function ae(y,r,p,e,s,u){return f(),v(G,{padding:""},{default:t(()=>[a(A,null,{default:t(()=>[a(x,null,{default:t(()=>r[16]||(r[16]=[F("Редактирование мероприятия")])),_:1})]),_:1}),e.conference&&e.conference.deleted_at?(f(),v(M,{key:0,"inline-actions":"",rounded:"",class:"bg-primary text-white"},{action:t(()=>[a(c,{flat:"",color:"white",label:"Восстановить",onClick:e.deleteHandler})]),default:t(()=>[r[17]||(r[17]=F(" Мероприятие успешно удалено "))]),_:1})):(f(),v(z,{key:1,onSubmit:e.submit,valid:e.form.valid},{default:t(()=>[a(O,null,{default:t(()=>[a(P,null,{default:t(()=>[a(e.UploadFileComponent,{modelValue:e.form.cover,"onUpdate:modelValue":r[0]||(r[0]=o=>e.form.cover=o),label:"Выбрать обложку",error:e.form.invalid("cover"),"error-message":e.form.errors.cover,onChange:r[1]||(r[1]=o=>e.form.validate("cover"))},null,8,["modelValue","error","error-message"]),e.form.cover?(f(),v(e.ImageComponent,{key:0,url:e.form.cover.url,"spinner-color":"white",class:"q-mb-sm","allow-fullscreen":"","quasar-component":"",fit:"scale-down","max-width":200,"max-height":200},null,8,["url"])):T("",!0),a(m,{modelValue:e.form.title,"onUpdate:modelValue":r[2]||(r[2]=o=>e.form.title=o),label:"Название мероприятия","lazy-rules":"",error:e.form.invalid("title"),"error-message":e.form.errors.title,onBlur:r[3]||(r[3]=o=>e.form.validate("title"))},null,8,["modelValue","error","error-message"]),a(m,{modelValue:e.form.description,"onUpdate:modelValue":r[4]||(r[4]=o=>e.form.description=o),label:"Описание мероприятия",type:"textarea",autogrow:"",error:e.form.invalid("description"),"error-message":e.form.errors.description,onBlur:r[5]||(r[5]=o=>e.form.validate("description"))},null,8,["modelValue","error","error-message"]),a(m,{modelValue:e.form.registration_url,"onUpdate:modelValue":r[6]||(r[6]=o=>e.form.registration_url=o),label:"Ссылка на регистрацию",error:e.form.invalid("registration_url"),"error-message":e.form.errors.registration_url,onBlur:r[7]||(r[7]=o=>e.form.validate("registration_url"))},null,8,["modelValue","error","error-message"]),a(m,{modelValue:e.form.price,"onUpdate:modelValue":r[8]||(r[8]=o=>e.form.price=o),label:"Цена",type:"number",prefix:"₽",error:e.form.invalid("price"),"error-message":e.form.errors.price,onBlur:r[9]||(r[9]=o=>e.form.validate("price"))},null,8,["modelValue","error","error-message"]),b("div",ee,[b("div",re,[a(m,{modelValue:e.startAt,"onUpdate:modelValue":r[10]||(r[10]=o=>e.startAt=o),label:"Дата начала",type:"datetime-local",error:e.form.invalid("start_at"),"error-message":e.form.errors.start_at,onBlur:r[11]||(r[11]=o=>e.form.validate("start_at"))},null,8,["modelValue","error","error-message"])]),b("div",oe,[a(m,{modelValue:e.endAt,"onUpdate:modelValue":r[12]||(r[12]=o=>e.endAt=o),label:"Дата окончания",type:"datetime-local",error:e.form.invalid("end_at"),"error-message":e.form.errors.end_at,onBlur:r[13]||(r[13]=o=>e.form.validate("end_at"))},null,8,["modelValue","error","error-message"])])]),a(e.UploadFileComponent,{modelValue:e.form.file,"onUpdate:modelValue":r[14]||(r[14]=o=>e.form.file=o),label:"Выбрать файл записи",error:e.form.invalid("file"),"error-message":e.form.errors.file,onChange:r[15]||(r[15]=o=>e.form.validate("file"))},null,8,["modelValue","error","error-message"])]),_:1}),a(q,{align:"right"},{default:t(()=>[a(c,{label:"Сохранить изменения",type:"submit",color:"primary",loading:e.form.processing,icon:"save"},null,8,["loading"]),a(c,{label:"Отмена",color:"grey-6",flat:"",onClick:e.cancel,icon:"close"}),a(c,{flat:"",dense:"",icon:"delete",color:"red",onClick:e.deleteHandler})]),_:1})]),_:1})]),_:1},8,["valid"])),a(j,{showing:e.loading},{default:t(()=>[a(R,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})}const Ee=H($,[["render",ae],["__file","EditPage.vue"]]);export{Ee as default};
