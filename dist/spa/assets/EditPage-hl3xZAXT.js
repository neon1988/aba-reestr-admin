import{a as w,Q as U}from"./QToolbar-Bhh1J96v.js";import{M as S,N as x,r as Q,w as k,o as N,a8 as A,_ as I,Q as s,R as f,S as l,T as a,W as _,U as v,V as P,Y as V}from"./index-CE79t1yK.js";import{Q as T}from"./QBanner-W142u_1a.js";import{Q as H}from"./use-transition-BrellFZR.js";import{Q as i}from"./QInput-DSqz_9T2.js";import{Q as q}from"./QCardSection-o1HUbWa7.js";import{Q as z}from"./QCardActions-FQP-hAmL.js";import{Q as M}from"./QCard-C--W-2v2.js";import{Q as O}from"./QForm-BGEKk4qY.js";import{Q as R,a as j}from"./QInnerLoading-DVRxtw88.js";import{Q as G}from"./QPage-0zgoenHj.js";import{u as L,a as c,U as W,b as Y}from"./UploadFileComponent-CPnVe3pD.js";import{b as J,d as K}from"./conferences-Cgvij20Y.js";import{u as X}from"./stat-store-6XmzY2hv.js";import"./use-dark-CY6fCMEH.js";import"./focus-manager-BJWzFvJg.js";import"./client-CKfML6Kh.js";import"./QBadge-BdZVIe1J.js";import"./QChip-7C_5roCM.js";import"./format-DyQxkAtJ.js";const Z=S({__name:"EditPage",props:{id:{}},setup(C,{expose:r}){r();const g=X(),e=x(),m=C,t=Q(null),o=L("patch",()=>`/conferences/${m.id}`,{cover:void 0,title:"",description:"",start_at:"",end_at:"",stream_url:"",price:"",file:void 0}),n=Q(!0);function p(u){return new Date(u).toISOString().slice(0,16)}const b=async()=>{try{const{data:u}=await J(m.id);u.data.start_at&&(u.data.start_at=p(u.data.start_at)),u.data.end_at&&(u.data.end_at=p(u.data.end_at)),t.value=u.data}catch{c("Не удалось загрузить данные мероприятия","negative"),e.push("/conferences")}finally{n.value=!1}},B=()=>{n.value=!0,o.submit().then(()=>{c("Мероприятие успешно обновлён","success"),e.push("/conferences")}).catch(u=>{const{response:d}=u;if(d.status===422){const{opts:F}=Y(d.data);A.create(F.value)}else c(d.data.message,"negative")}).finally(()=>{n.value=!1})},D=async()=>{if(t.value){n.value=!0;try{const{data:u}=await K(t.value.id);t.value=u.data,await g.fetchStats()}catch{c("Не удалось удалить мероприятие","negative")}finally{n.value=!1}}},E=()=>{e.push("/conferences")};k(t,()=>{t.value&&o.setData(t.value)}),N(()=>{b()});const y={statStore:g,router:e,props:m,conference:t,form:o,loading:n,formatDateForInput:p,loadConferenceData:b,submit:B,deleteHandler:D,cancel:E,UploadFileComponent:W};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}}),h={class:"row q-col-gutter-sm"},$={class:"col-6"},ee={class:"col-6"};function re(C,r,g,e,m,t){return s(),f(G,{padding:""},{default:l(()=>[a(U,null,{default:l(()=>[a(w,null,{default:l(()=>r[16]||(r[16]=[_("Редактирование мероприятия")])),_:1})]),_:1}),e.conference&&e.conference.deleted_at?(s(),f(T,{key:0,"inline-actions":"",rounded:"",class:"bg-primary text-white"},{action:l(()=>[a(v,{flat:"",color:"white",label:"Восстановить",onClick:e.deleteHandler})]),default:l(()=>[r[17]||(r[17]=_(" Мероприятие успешно удалено "))]),_:1})):(s(),f(O,{key:1,onSubmit:e.submit,valid:e.form.valid},{default:l(()=>[a(M,null,{default:l(()=>[a(q,null,{default:l(()=>[a(e.UploadFileComponent,{modelValue:e.form.cover,"onUpdate:modelValue":r[0]||(r[0]=o=>e.form.cover=o),label:"Выбрать обложку",error:e.form.invalid("cover"),"error-message":e.form.errors.cover,onChange:r[1]||(r[1]=o=>e.form.validate("cover"))},null,8,["modelValue","error","error-message"]),e.form.cover?(s(),f(H,{key:0,src:e.form.cover.url,"spinner-color":"white",class:"q-mb-sm",style:{height:"10rem","max-width":"10rem"}},null,8,["src"])):P("",!0),a(i,{modelValue:e.form.title,"onUpdate:modelValue":r[2]||(r[2]=o=>e.form.title=o),label:"Название мероприятия","lazy-rules":"",error:e.form.invalid("title"),"error-message":e.form.errors.title,onBlur:r[3]||(r[3]=o=>e.form.validate("title"))},null,8,["modelValue","error","error-message"]),a(i,{modelValue:e.form.description,"onUpdate:modelValue":r[4]||(r[4]=o=>e.form.description=o),label:"Описание мероприятия",type:"textarea",autogrow:"",error:e.form.invalid("description"),"error-message":e.form.errors.description,onBlur:r[5]||(r[5]=o=>e.form.validate("description"))},null,8,["modelValue","error","error-message"]),a(i,{modelValue:e.form.stream_url,"onUpdate:modelValue":r[6]||(r[6]=o=>e.form.stream_url=o),label:"Ссылка на трансляцию",error:e.form.invalid("stream_url"),"error-message":e.form.errors.stream_url,onBlur:r[7]||(r[7]=o=>e.form.validate("stream_url"))},null,8,["modelValue","error","error-message"]),a(i,{modelValue:e.form.price,"onUpdate:modelValue":r[8]||(r[8]=o=>e.form.price=o),label:"Цена",type:"number",prefix:"₽",error:e.form.invalid("price"),"error-message":e.form.errors.price,onBlur:r[9]||(r[9]=o=>e.form.validate("price"))},null,8,["modelValue","error","error-message"]),V("div",h,[V("div",$,[a(i,{modelValue:e.form.start_at,"onUpdate:modelValue":r[10]||(r[10]=o=>e.form.start_at=o),label:"Дата начала",type:"datetime-local",error:e.form.invalid("start_at"),"error-message":e.form.errors.start_at,onBlur:r[11]||(r[11]=o=>e.form.validate("start_at"))},null,8,["modelValue","error","error-message"])]),V("div",ee,[a(i,{modelValue:e.form.end_at,"onUpdate:modelValue":r[12]||(r[12]=o=>e.form.end_at=o),label:"Дата окончания",type:"datetime-local",error:e.form.invalid("end_at"),"error-message":e.form.errors.end_at,onBlur:r[13]||(r[13]=o=>e.form.validate("end_at"))},null,8,["modelValue","error","error-message"])])]),a(e.UploadFileComponent,{modelValue:e.form.file,"onUpdate:modelValue":r[14]||(r[14]=o=>e.form.file=o),label:"Выбрать обложку",error:e.form.invalid("file"),"error-message":e.form.errors.file,onChange:r[15]||(r[15]=o=>e.form.validate("file"))},null,8,["modelValue","error","error-message"])]),_:1}),a(z,{align:"right"},{default:l(()=>[a(v,{label:"Сохранить изменения",type:"submit",color:"primary",loading:e.form.processing,icon:"save"},null,8,["loading"]),a(v,{label:"Отмена",color:"grey-6",flat:"",onClick:e.cancel,icon:"close"}),a(v,{flat:"",dense:"",icon:"delete",color:"red",onClick:e.deleteHandler})]),_:1})]),_:1})]),_:1},8,["valid"])),a(j,{showing:e.loading},{default:l(()=>[a(R,{size:"5rem",color:"primary"})]),_:1},8,["showing"])]),_:1})}const _e=I(Z,[["render",re],["__file","EditPage.vue"]]);export{_e as default};
